import*as THREE from"three";import{FBXLoader}from"three/addons/loaders/FBXLoader.js";import{OrbitControls}from"three/addons/controls/OrbitControls.js";import{EffectComposer}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass}from"three/addons/postprocessing/UnrealBloomPass.js";import{ShaderPass}from"three/addons/postprocessing/ShaderPass.js";import{Reflector}from"three/addons/objects/Reflector.js";const CONFIG={CAMERA:{FOV:50,NEAR:.1,FAR:5e3},BLOOM:{STRENGTH:.2,RADIUS:.7,THRESHOLD:.9},FISHEYE:{FOV:60,STRENGTH:.165,CYLINDRICAL_RATIO:1},RGB_SPLIT:{AMOUNT:.002},GRAIN:{AMOUNT:.075},FOG:{COLOR:16747520,DENSITY:.0363},CLICK:{THRESHOLD:10,MAX_TIME:500},SOUND:{THROTTLE:50}};function isMobileDevice(){const e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t="ontouchstart"in window||navigator.maxTouchPoints>0,o=window.innerWidth<768;return e||t&&o}const IS_MOBILE=isMobileDevice(),scene=new THREE.Scene;scene.background=new THREE.Color(1710618);const camera=new THREE.PerspectiveCamera(CONFIG.CAMERA.FOV,window.innerWidth/window.innerHeight,CONFIG.CAMERA.NEAR,CONFIG.CAMERA.FAR);scene.add(camera),camera.position.set(0,5,10),camera.updateProjectionMatrix();const renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0});renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.toneMapping=THREE.ACESFilmicToneMapping,renderer.toneMappingExposure=.3,renderer.outputColorSpace=THREE.SRGBColorSpace;const container=document.getElementById("canvas-container");container?container.appendChild(renderer.domElement):document.body.appendChild(renderer.domElement);const controls=new OrbitControls(camera,renderer.domElement);IS_MOBILE?(controls.enabled=!1,renderer.domElement.style.pointerEvents="none"):(controls.enableDamping=!0,controls.dampingFactor=.05,controls.enablePan=!0,controls.panSpeed=.8,controls.screenSpacePanning=!0,controls.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},controls.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"});let isDragging=!1,cameraIsBeingRotated=!1,lastCameraRotationTime=0;if(!IS_MOBILE){controls.addEventListener("start",()=>{cameraIsBeingRotated=!0,isDragging=!0,lastCameraRotationTime=Date.now()}),controls.addEventListener("end",()=>{cameraIsBeingRotated=!1});const e=renderer.domElement;let t=!1;e.addEventListener("mousedown",e=>{t=e.metaKey||e.ctrlKey,t&&0===e.button?controls.mouseButtons.LEFT=THREE.MOUSE.PAN:t||0!==e.button||(controls.mouseButtons.LEFT=THREE.MOUSE.ROTATE)}),e.addEventListener("mouseup",()=>{t||(controls.mouseButtons.LEFT=THREE.MOUSE.ROTATE)})}function kelvinToRgb(e){const t=e/100;let o,n,i;return t<=66?(o=255,n=t,n=99.4708025861*Math.log(n)-161.1195681661,t<=19?i=0:(i=t-10,i=138.5177312231*Math.log(i)-305.0447927307)):(o=t-60,o=329.698727446*Math.pow(o,-.1332047592),n=t-60,n=288.1221695283*Math.pow(n,-.0755148492),i=255),o=Math.max(0,Math.min(255,o)),n=Math.max(0,Math.min(255,n)),i=Math.max(0,Math.min(255,i)),new THREE.Color(o/255,n/255,i/255)}function pushColorTowardsYellow(e,t=.25){const o=new THREE.Color(16776960),n=e.clone();return n.r+=(o.r-e.r)*t,n.g+=(o.g-e.g)*t,n.b+=(o.b-e.b)*t,n}const keyLight=new THREE.DirectionalLight(kelvinToRgb(6e3),2);keyLight.position.set(8,10,6),keyLight.castShadow=!0,keyLight.shadow.mapSize.width=2048,keyLight.shadow.mapSize.height=2048,keyLight.shadow.camera.near=.5,keyLight.shadow.camera.far=50,keyLight.shadow.camera.left=-10,keyLight.shadow.camera.right=10,keyLight.shadow.camera.top=10,keyLight.shadow.camera.bottom=-10,scene.add(keyLight);const fillLightColor=pushColorTowardsYellow(kelvinToRgb(3200)),fillLight=new THREE.DirectionalLight(fillLightColor,2.5);fillLight.position.set(-8,6,5),scene.add(fillLight);const backLight=new THREE.DirectionalLight(kelvinToRgb(8e3),2);backLight.position.set(-3,8,-10),scene.add(backLight);const ambientLight=new THREE.AmbientLight(16777215,.5);scene.add(ambientLight);const composer=new EffectComposer(renderer),renderPass=new RenderPass(scene,camera);composer.addPass(renderPass);const bloomPass=new UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),CONFIG.BLOOM.STRENGTH,CONFIG.BLOOM.RADIUS,CONFIG.BLOOM.THRESHOLD);composer.addPass(bloomPass);const fisheyeShader={uniforms:{tDiffuse:{value:null},strength:{value:.3},height:{value:1},aspectRatio:{value:1},cylindricalRatio:{value:1}},vertexShader:"\n        uniform float strength;\n        uniform float height;\n        uniform float aspectRatio;\n        uniform float cylindricalRatio;\n        \n        varying vec3 vUV;\n        varying vec2 vUVDot;\n        \n        void main() {\n            gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));\n            \n            float scaledHeight = strength * height;\n            float cylAspectRatio = aspectRatio * cylindricalRatio;\n            float aspectDiagSq = aspectRatio * aspectRatio + 1.0;\n            float diagSq = scaledHeight * scaledHeight * aspectDiagSq;\n            vec2 signedUV = (2.0 * uv + vec2(-1.0, -1.0));\n            \n            float z = 0.5 * sqrt(diagSq + 1.0) + 0.5;\n            float ny = (z - 1.0) / (cylAspectRatio * cylAspectRatio + 1.0);\n            \n            vUVDot = sqrt(ny) * vec2(cylAspectRatio, 1.0) * signedUV;\n            vUV = vec3(0.5, 0.5, 1.0) * z + vec3(-0.5, -0.5, 0.0);\n            vUV.xy += uv;\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        varying vec3 vUV;\n        varying vec2 vUVDot;\n        \n        void main() {\n            vec3 uv = dot(vUVDot, vUVDot) * vec3(-0.5, -0.5, -1.0) + vUV;\n            gl_FragColor = texture2DProj(tDiffuse, uv);\n        }\n    "},fisheyePass=new ShaderPass(fisheyeShader),horizontalFOV=CONFIG.FISHEYE.FOV,strength=CONFIG.FISHEYE.STRENGTH,cylindricalRatio=CONFIG.FISHEYE.CYLINDRICAL_RATIO,height=Math.tan(THREE.MathUtils.degToRad(horizontalFOV)/2)/camera.aspect;fisheyePass.uniforms.strength.value=strength,fisheyePass.uniforms.height.value=height,fisheyePass.uniforms.aspectRatio.value=camera.aspect,fisheyePass.uniforms.cylindricalRatio.value=cylindricalRatio,composer.addPass(fisheyePass);const rgbSplitShader={uniforms:{tDiffuse:{value:null},amount:{value:.00225}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform float amount;\n        varying vec2 vUv;\n        \n        void main() {\n            vec2 offset = amount * vec2(1.0, 0.0);\n            float r = texture2D(tDiffuse, vUv + offset).r;\n            float g = texture2D(tDiffuse, vUv).g;\n            float b = texture2D(tDiffuse, vUv - offset).b;\n            gl_FragColor = vec4(r, g, b, 1.0);\n        }\n    "},rgbSplitPass=new ShaderPass(rgbSplitShader);composer.addPass(rgbSplitPass);const vignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:.93},darkness:{value:.6}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform float offset;\n        uniform float darkness;\n        varying vec2 vUv;\n        \n        void main() {\n            vec4 texel = texture2D(tDiffuse, vUv);\n            vec2 uv = (vUv - vec2(0.5)) * vec2(1.0);\n            float dist = length(uv);\n            float vignette = smoothstep(offset, darkness + offset, dist);\n            texel.rgb = mix(texel.rgb, texel.rgb * (1.0 - vignette), 0.8);\n            gl_FragColor = texel;\n        }\n    "},vignettePass=new ShaderPass(vignetteShader);composer.addPass(vignettePass);const badTVShader={uniforms:{tDiffuse:{value:null},time:{value:0},distortion:{value:1.5},distortion2:{value:2},speed:{value:.1},rollSpeed:{value:.05}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform float time;\n        uniform float distortion;\n        uniform float distortion2;\n        uniform float speed;\n        uniform float rollSpeed;\n        varying vec2 vUv;\n        \n        // Ashima 2D Simplex Noise\n        vec3 mod289(vec3 x) {\n            return x - floor(x * (1.0 / 289.0)) * 289.0;\n        }\n        \n        vec2 mod289(vec2 x) {\n            return x - floor(x * (1.0 / 289.0)) * 289.0;\n        }\n        \n        vec3 permute(vec3 x) {\n            return mod289(((x*34.0)+1.0)*x);\n        }\n        \n        float snoise(vec2 v) {\n            const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);\n            vec2 i = floor(v + dot(v, C.yy));\n            vec2 x0 = v - i + dot(i, C.xx);\n            \n            vec2 i1;\n            i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n            vec4 x12 = x0.xyxy + C.xxzz;\n            x12.xy -= i1;\n            \n            i = mod289(i);\n            vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n            \n            vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n            m = m*m;\n            m = m*m;\n            \n            vec3 x = 2.0 * fract(p * C.www) - 1.0;\n            vec3 h = abs(x) - 0.5;\n            vec3 ox = floor(x + 0.5);\n            vec3 a0 = x - ox;\n            \n            m *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n            \n            vec3 g;\n            g.x = a0.x * x0.x + h.x * x0.y;\n            g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n            return 130.0 * dot(m, g);\n        }\n        \n        void main() {\n            vec2 p = vUv;\n            float ty = time * speed;\n            float yt = p.y - ty;\n            \n            // Smooth distortion\n            float offset = snoise(vec2(yt * 3.0, 0.0)) * 0.2;\n            \n            // Boost distortion\n            offset = offset * distortion * offset * distortion * offset;\n            \n            // Add fine grain distortion\n            offset += snoise(vec2(yt * 50.0, 0.0)) * distortion2 * 0.001;\n            \n            // Combine distortion on X with roll on Y\n            gl_FragColor = texture2D(tDiffuse, vec2(fract(p.x + offset), fract(p.y - time * rollSpeed)));\n        }\n    "},grainShader={uniforms:{tDiffuse:{value:null},time:{value:0},amount:{value:.075}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform float time;\n        uniform float amount;\n        varying vec2 vUv;\n        \n        float random(vec2 st) {\n            return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n        }\n        \n        void main() {\n            vec4 color = texture2D(tDiffuse, vUv);\n            \n            // Generate random grain\n            float grain = random(vUv * vec2(200.0, 200.0) + time);\n            \n            // Overlay blending mode - only affects blacks and doesn't gray\n            float grainValue = (grain - 0.5) * amount;\n            \n            // Apply dark grain with overlay-like behavior\n            gl_FragColor = color - vec4(grainValue * 0.5);\n        }\n    "},grainPass=new ShaderPass(grainShader);grainPass.uniforms.amount.value=CONFIG.GRAIN.AMOUNT;let grainTime=0;composer.addPass(grainPass),scene.fog=new THREE.FogExp2(CONFIG.FOG.COLOR,CONFIG.FOG.DENSITY);const panelBlurShader={uniforms:{tDiffuse:{value:null},resolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},rectUV:{value:new THREE.Vector4(0,0,0,0)},blurSize:{value:12}},vertexShader:"\n        varying vec2 vUv;\n        void main(){\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",fragmentShader:"\n        uniform sampler2D tDiffuse;\n        uniform vec2 resolution;\n        uniform vec4 rectUV; // x0,y0,x1,y1\n        uniform float blurSize;\n        varying vec2 vUv;\n\n        bool inRect(vec2 uv, vec4 r){\n            return uv.x >= r.x && uv.x <= r.z && uv.y >= r.y && uv.y <= r.w;\n        }\n\n        void main(){\n            vec4 base = texture2D(tDiffuse, vUv);\n            if (!inRect(vUv, rectUV)){\n                gl_FragColor = base;\n                return;\n            }\n            // Higher quality approximate Gaussian blur (32 taps)\n            vec2 px = blurSize / resolution;\n            vec4 c = vec4(0.0);\n            float w0 = 0.140; // center\n            float w1 = 0.110; // 1 px offsets\n            float w2 = 0.075; // 1 px diagonals\n            float w3 = 0.060; // 2 px offsets\n            float w4 = 0.040; // 2 px diagonals\n            float w5 = 0.025; // 3 px offsets\n            float w6 = 0.015; // 3 px diagonals\n            \n            // center\n            c += texture2D(tDiffuse, vUv) * w0;\n            \n            // 1 px cross\n            c += texture2D(tDiffuse, vUv + vec2( px.x, 0.0)) * w1;\n            c += texture2D(tDiffuse, vUv + vec2(-px.x, 0.0)) * w1;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 ,  px.y)) * w1;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 , -px.y)) * w1;\n            \n            // 1 px diagonals\n            c += texture2D(tDiffuse, vUv + vec2( px.x,  px.y)) * w2;\n            c += texture2D(tDiffuse, vUv + vec2(-px.x,  px.y)) * w2;\n            c += texture2D(tDiffuse, vUv + vec2( px.x, -px.y)) * w2;\n            c += texture2D(tDiffuse, vUv + vec2(-px.x, -px.y)) * w2;\n            \n            // 2 px cross\n            c += texture2D(tDiffuse, vUv + vec2( 2.0*px.x, 0.0)) * w3;\n            c += texture2D(tDiffuse, vUv + vec2(-2.0*px.x, 0.0)) * w3;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 ,  2.0*px.y)) * w3;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 , -2.0*px.y)) * w3;\n            \n            // 2 px diagonals\n            c += texture2D(tDiffuse, vUv + vec2( 2.0*px.x,  2.0*px.y)) * w4;\n            c += texture2D(tDiffuse, vUv + vec2(-2.0*px.x,  2.0*px.y)) * w4;\n            c += texture2D(tDiffuse, vUv + vec2( 2.0*px.x, -2.0*px.y)) * w4;\n            c += texture2D(tDiffuse, vUv + vec2(-2.0*px.x, -2.0*px.y)) * w4;\n\n            // 3 px cross\n            c += texture2D(tDiffuse, vUv + vec2( 3.0*px.x, 0.0)) * w5;\n            c += texture2D(tDiffuse, vUv + vec2(-3.0*px.x, 0.0)) * w5;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 ,  3.0*px.y)) * w5;\n            c += texture2D(tDiffuse, vUv + vec2(0.0 , -3.0*px.y)) * w5;\n\n            // 3 px diagonals\n            c += texture2D(tDiffuse, vUv + vec2( 3.0*px.x,  3.0*px.y)) * w6;\n            c += texture2D(tDiffuse, vUv + vec2(-3.0*px.x,  3.0*px.y)) * w6;\n            c += texture2D(tDiffuse, vUv + vec2( 3.0*px.x, -3.0*px.y)) * w6;\n            c += texture2D(tDiffuse, vUv + vec2(-3.0*px.x, -3.0*px.y)) * w6;\n            \n            gl_FragColor = c;\n        }\n    "},ENABLE_PANEL_BLUR=!1;let panelBlurPass=null;const raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;let mouseX=0,mouseY=0,hoveredMesh=null,hoverFadeProgress=0,boundingBoxHelper=null,cornerIndicators=[],cornerLabels=[],labelsLayerEl=null,lockRing=null,lockRingTargetScale=1,lockRingThickness=.01,lockRingTargetThickness=.01,lockRingAnim={active:!1,startTime:0,duration:200,fromScale:1,toScale:1,fromThick:.01,toThick:.01,fromOpacity:0,toOpacity:0};const ENABLE_HOVER_LIGHT=!0,ENABLE_SPOT_SHADOW=!1,ENABLE_GHOST_POINTS=!1;let infoPanelEnabled=!0,autoRotateEnabled=!0,assetsReady=!1,__sharedGlassMaterial=null,__windshieldGlassMaterial=null;function getStableLocalCenter(e){const t=new THREE.Box3,o=new THREE.Vector3;t.setFromObject(e);let n=t.getCenter(new THREE.Vector3);if(!(Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z))&&e.geometry){e.geometry.computeBoundingBox();const t=e.geometry.boundingBox;t&&(n=t.getCenter(new THREE.Vector3),e.localToWorld(n))}Number.isFinite(n.x)&&Number.isFinite(n.y)&&Number.isFinite(n.z)||(n=e.getWorldPosition(new THREE.Vector3));const i=e.worldToLocal(n.clone());return Number.isFinite(i.x)&&Number.isFinite(i.y)&&Number.isFinite(i.z)?i:o.set(0,0,0)}let uiCogMesh=null,uiCogTargetPx=141;function initializeUICog(){if(!uiCogMesh)try{const e=new Image;e.onload=()=>{const t=document.createElement("canvas");t.width=uiCogTargetPx,t.height=uiCogTargetPx;const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);const n=Math.floor(.08*t.width);o.drawImage(e,n,n,t.width-2*n,t.height-2*n),o.globalCompositeOperation="source-atop",o.fillStyle="#ffd700",o.fillRect(0,0,t.width,t.height),o.globalCompositeOperation="source-over";const i=new THREE.CanvasTexture(t);i.colorSpace=THREE.SRGBColorSpace;const r=new THREE.MeshBasicMaterial({map:i,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),a=new THREE.PlaneGeometry(1,1);uiCogMesh=new THREE.Mesh(a,r),camera.add(uiCogMesh),uiCogMesh.position.set(0,0,-1),uiCogMesh.renderOrder=2e3,uiCogMesh.frustumCulled=!1},e.src="porsche-3-logo-svg-vector.svg"}catch(e){}}function layoutUICog(){if(!uiCogMesh)return;uiCogMesh.position.z=-1;const e=THREE.MathUtils.degToRad(camera.fov||50),t=2*Math.tan(e/2)*1,o=t*(camera.aspect||window.innerWidth/Math.max(1,window.innerHeight)),n=t/Math.max(1,window.innerHeight)*uiCogTargetPx,i=n;uiCogMesh.scale.set(i,n,1);const r=(50-window.innerWidth/2+uiCogTargetPx/2)*(o/Math.max(1,window.innerWidth)),a=(-window.innerHeight/2+50+uiCogTargetPx/2)*(t/Math.max(1,window.innerHeight));uiCogMesh.position.x=r,uiCogMesh.position.y=a}function buildLockRingGeometry(e,t,o=32){const n=e,i=e*(1-Math.max(0,Math.min(1,t))),r=new Float32Array(2*o*3);for(let e=0;e<o;e++){const t=e/o*Math.PI*2,a=Math.cos(t),s=Math.sin(t),l=a*n,c=s*n,d=a*i,u=s*i,h=2*e*3;r[h+0]=l,r[h+1]=0,r[h+2]=c,r[h+3]=d,r[h+4]=0,r[h+5]=u}const a=new THREE.BufferGeometry;return a.setAttribute("position",new THREE.BufferAttribute(r,3)),a}let boundingBoxAnimation={isAnimating:!1,startTime:0,duration:200,startScale:new THREE.Vector3(0,0,0),targetScale:new THREE.Vector3(1,1,1),currentScale:new THREE.Vector3(0,0,0),cornerIndicators:[]};function easeOut(e){return 1-Math.pow(1-e,3)}function startBoundingBoxAnimation(){boundingBoxAnimation.isAnimating=!0,boundingBoxAnimation.startTime=performance.now(),boundingBoxAnimation.startScale.set(0,0,0),boundingBoxAnimation.targetScale.set(1,1,1),boundingBoxAnimation.currentScale.set(0,0,0),boundingBoxAnimation.cornerIndicators=[],boundingBoxAnimation.cornerLabels=[]}let enableScreenOutline=!1,modelMaxDimension=1,warningMesh=null,warningOriginalEmissive=null,warningOriginalEmissiveIntensity=0,hoverPointLight=null,hoverLightOwner=null,hoverLightLastUpdate=0;function cleanupHoverLights(){const e=[];scene.traverse(t=>{if(t.isLight&&t.userData&&t.userData.isHoverLight){if(hoverPointLight&&t===hoverPointLight)return;e.push(t)}}),e.forEach(e=>{e.parent&&e.parent.remove(e),e.dispose?.()})}let currentText="",targetText="",textDecodeIndex=0,textDecodeSpeed=3;const orbitsGroup=new THREE.Group;orbitsGroup.userData.isHelper=!0;let orbitParents=[];function createPlanetaryOrbitsAround(e){const t=(new THREE.Box3).setFromObject(e),o=t.getSize(new THREE.Vector3),n=t.getCenter(new THREE.Vector3),i=Math.max(o.x,o.y,o.z),r=.8*i;function a(e,t,o,n,i){const r=new THREE.Group;r.rotation.set(o.x,o.y,o.z);const a=.5*(e*(2*Math.PI/n)),s=new THREE.LineBasicMaterial({color:t,transparent:!0,opacity:.8});for(let t=0;t<n;t++){const o=t/n*Math.PI*2,i=new THREE.Vector3(Math.cos(o)*e,0,Math.sin(o)*e),l=new THREE.Vector3(-Math.sin(o),0,Math.cos(o)).normalize(),c=i.clone().addScaledVector(l,.5*-a),d=i.clone().addScaledVector(l,.5*a),u=(new THREE.BufferGeometry).setFromPoints([c,d]),h=new THREE.Line(u,s.clone());r.add(h)}const l=(new THREE.Path).absarc(0,0,e,0,2*Math.PI,!1).getPoints(256),c=(new THREE.BufferGeometry).setFromPoints(l.map(e=>new THREE.Vector3(e.x,0,e.y))),d=new THREE.LineBasicMaterial({color:t,opacity:.18,transparent:!0}),u=new THREE.LineLoop(c,d);r.add(u),orbitsGroup.add(r),orbitParents.push({parent:r,spinSpeed:i})}orbitsGroup.position.set(n.x,n.y+.05*o.y,n.z);const s=.965*r,l=.94*r;a(.995*r,16753920,new THREE.Euler(.45,0,.12),64,.12),a(s,16766720,new THREE.Euler(.1,.6,-.2),96,-.08),a(l,16746564,new THREE.Euler(-.35,-.15,.4),128,.06)}scene.add(orbitsGroup);const scatteredCrossGroup=new THREE.Group;scatteredCrossGroup.userData.isHelper=!0;let scatteredCrosses=[];function createScatteredCrossesAround(e,t=32){const o=(new THREE.Box3).setFromObject(e).getSize(new THREE.Vector3),n=.65*Math.max(o.x,o.y,o.z),i=1.26*n;scatteredCrosses.forEach(e=>scatteredCrossGroup.remove(e)),scatteredCrosses=[];const r=2/t,a=Math.PI*(3-Math.sqrt(5));for(let e=0;e<t;e++){const t=e*r-1+r/2,o=Math.sqrt(1-t*t),s=e*a,l=new THREE.Vector3(Math.cos(s)*o,t,Math.sin(s)*o).multiplyScalar(i),c=.3*(.04*n),d=[new THREE.Vector3(-c,0,0),new THREE.Vector3(c,0,0),new THREE.Vector3(0,-c,0),new THREE.Vector3(0,c,0),new THREE.Vector3(0,0,-c),new THREE.Vector3(0,0,c)],u=(new THREE.BufferGeometry).setFromPoints(d),h=new THREE.LineBasicMaterial({color:16766720,transparent:!0,opacity:.6}),m=new THREE.LineSegments(u,h);m.position.copy(l),m.raycast=()=>{},scatteredCrossGroup.add(m),scatteredCrosses.push(m)}}scene.add(scatteredCrossGroup);let tooltipTypewriterActive=!1,tooltipCurrentText="",tooltipTargetText="",tooltipTypewriterIndex=0,tooltipTypewriterSpeed=1.5;const hoverSound=new Audio("Media/261590__kwahmah_02__little-glitch.flac");hoverSound.volume=.36;let audioContext=null,soundThrottleLastPlayed={};const SOUND_THROTTLE=CONFIG.SOUND.THROTTLE;function initAudioContext(){audioContext||(audioContext=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audioContext.state&&audioContext.resume()}function createUISound(e){if(initAudioContext(),!audioContext)return;const t=performance.now();if(soundThrottleLastPlayed[e]&&t-soundThrottleLastPlayed[e]<SOUND_THROTTLE)return;soundThrottleLastPlayed[e]=t;const o=audioContext.currentTime;switch(e){case"reveal":const e=audioContext.createOscillator(),t=audioContext.createGain();e.type="square",e.frequency.setValueAtTime(800,o),e.frequency.exponentialRampToValueAtTime(1200,o+.08),t.gain.setValueAtTime(0,o),t.gain.linearRampToValueAtTime(.09,o+.01),t.gain.exponentialRampToValueAtTime(.001,o+.08),e.connect(t),t.connect(audioContext.destination),e.start(o),e.stop(o+.08);break;case"close":const n=audioContext.createOscillator(),i=audioContext.createGain();n.type="square",n.frequency.setValueAtTime(1200,o),n.frequency.exponentialRampToValueAtTime(600,o+.1),i.gain.setValueAtTime(0,o),i.gain.linearRampToValueAtTime(.075,o+.01),i.gain.exponentialRampToValueAtTime(.001,o+.1),n.connect(i),i.connect(audioContext.destination),n.start(o),n.stop(o+.1);break;case"hover":const r=audioContext.createOscillator(),a=audioContext.createGain();r.type="square",r.frequency.setValueAtTime(1800,o),a.gain.setValueAtTime(0,o),a.gain.linearRampToValueAtTime(.06,o+.005),a.gain.exponentialRampToValueAtTime(.001,o+.03),r.connect(a),a.connect(audioContext.destination),r.start(o),r.stop(o+.03);break;case"select":const s=audioContext.createOscillator(),l=audioContext.createGain();s.type="square",s.frequency.setValueAtTime(2200,o),l.gain.setValueAtTime(0,o),l.gain.linearRampToValueAtTime(.075,o+.002),l.gain.exponentialRampToValueAtTime(.001,o+.02),s.connect(l),l.connect(audioContext.destination),s.start(o),s.stop(o+.02)}}let uiHoverSoundLastPlayed=0;const UI_HOVER_SOUND_THROTTLE=150,ambientMusic=new Audio("Media/674414__gregorquendel__sci-fi-soundscape-drone-pad-harmonic-008-iv-designed-atmospheres.mp3");ambientMusic.volume=.4,ambientMusic.loop=!0,ambientMusic.preload="auto",ambientMusic.crossOrigin="anonymous";let partSelectSoundBuffer=null,partSelectSoundReversedBuffer=null;async function loadPartSelectSound(){if(!partSelectSoundBuffer)try{if(initAudioContext(),!audioContext)return;const e=await fetch("Media/419823__glaneur-de-sons__bbb-soft-05.wav"),t=await e.arrayBuffer();partSelectSoundBuffer=await audioContext.decodeAudioData(t);const o=partSelectSoundBuffer.length,n=audioContext.createBuffer(partSelectSoundBuffer.numberOfChannels,o,partSelectSoundBuffer.sampleRate);for(let e=0;e<partSelectSoundBuffer.numberOfChannels;e++){const t=partSelectSoundBuffer.getChannelData(e),i=n.getChannelData(e);for(let e=0;e<o;e++)i[e]=t[o-1-e]}partSelectSoundReversedBuffer=n}catch(e){console.error("Failed to load part selection sound:",e)}}function playPartSelectSound(e=!1){if(initAudioContext(),!audioContext)return void(partSelectSoundBuffer||partSelectSoundReversedBuffer||loadPartSelectSound().then(()=>{audioContext&&playPartSelectSound(e)}));if("suspended"===audioContext.state&&audioContext.resume(),!partSelectSoundBuffer&&!partSelectSoundReversedBuffer)return void loadPartSelectSound().then(()=>playPartSelectSound(e));const t=e?partSelectSoundReversedBuffer:partSelectSoundBuffer;if(!t)return;const o=audioContext.createBufferSource(),n=audioContext.createGain();o.buffer=t,o.connect(n),n.connect(audioContext.destination),n.gain.value=.6,o.start(0)}let isMusicPlaying=!1;function initializeMusicPlayer(){const e=document.getElementById("music-player"),t=document.getElementById("music-icon");e&&t?(t.innerHTML='<i data-feather="music"></i>',"undefined"!=typeof feather&&feather.replace(),e.addEventListener("click",()=>{isMusicPlaying?(ambientMusic.pause(),isMusicPlaying=!1,e.classList.remove("playing"),t.innerHTML='<i data-feather="music"></i>',"undefined"!=typeof feather&&feather.replace(),console.log("Music paused")):ambientMusic.play().then(()=>{isMusicPlaying=!0,e.classList.add("playing"),t.innerHTML='<i data-feather="pause"></i>',"undefined"!=typeof feather&&feather.replace(),console.log("Music started")}).catch(e=>{console.error("Failed to play music:",e)})}),console.log("Music player initialized")):console.error("Music player elements not found")}function initializeFullscreen(){const e=document.getElementById("fullscreen-button"),t=document.getElementById("fullscreen-icon");function o(){document.fullscreenElement?document.exitFullscreen().then(()=>{console.log("Exited fullscreen"),t.innerHTML='<i data-feather="maximize"></i>',"undefined"!=typeof feather&&feather.replace()}).catch(e=>{console.error("Error exiting fullscreen:",e)}):document.documentElement.requestFullscreen().then(()=>{console.log("Entered fullscreen"),t.innerHTML='<i data-feather="minimize"></i>',"undefined"!=typeof feather&&feather.replace()}).catch(e=>{console.error("Error entering fullscreen:",e)})}e&&t?(t.innerHTML='<i data-feather="maximize"></i>',"undefined"!=typeof feather&&feather.replace(),e.addEventListener("click",o),document.addEventListener("keydown",e=>{"j"!==e.key.toLowerCase()||e.ctrlKey||e.metaKey||e.altKey||"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.preventDefault(),o())}),document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?t.innerHTML='<i data-feather="minimize"></i>':t.innerHTML='<i data-feather="maximize"></i>',"undefined"!=typeof feather&&feather.replace()}),console.log("Fullscreen functionality initialized (J key)")):console.error("Fullscreen elements not found")}function initializeInfoToggle(){const e=document.getElementById("info-button"),t=document.getElementById("info-icon"),o=document.getElementById("part-container");if(!e||!t||!o)return;if(t.innerHTML='<i data-feather="info"></i>',"undefined"!=typeof feather)try{feather.replace()}catch(e){}const n=()=>{infoPanelEnabled?e.classList.remove("off"):e.classList.add("off")};n(),e.addEventListener("click",()=>{infoPanelEnabled=!infoPanelEnabled,n(),infoPanelEnabled?hoveredMesh&&o.classList.add("visible"):o.classList.remove("visible")})}const uiHoverBlinkTargets=[];function initializeUIHoverBlink(){["music-player","rotate-button","info-button","fullscreen-button","book-button"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("mouseenter",()=>{t.classList.add("ui-hover-blink"),uiHoverBlinkTargets.includes(t)||uiHoverBlinkTargets.push(t),createUISound("hover")}),t.addEventListener("mouseleave",()=>{t.classList.remove("ui-hover-blink"),t.style.opacity=""}))})}function initializeBookButton(){const e=document.getElementById("book-button"),t=document.getElementById("book-icon");e&&t?(t.innerHTML='<i data-feather="book"></i>',"undefined"!=typeof feather&&feather.replace(),e.addEventListener("click",e=>{e.stopPropagation(),console.log("Book button clicked!"),showPorscheHistory()}),console.log("Book button initialized")):console.warn("Book button elements not found")}function initializeRotateToggle(){const e=document.getElementById("rotate-button"),t=document.getElementById("rotate-icon");if(!e||!t)return;if(t.innerHTML='<i data-feather="repeat"></i>',"undefined"!=typeof feather)try{feather.replace()}catch(e){}const o=()=>{autoRotateEnabled?e.classList.remove("paused"):e.classList.add("paused")};o(),e.addEventListener("click",()=>{autoRotateEnabled=!autoRotateEnabled,o()})}function capitalizeFirstLetter(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function getStatusIcon(e){return e.includes("Maintenance")||e.includes("Warning")?"alert-triangle":e.includes("Operational")||e.includes("Excellent")||e.includes("Good Condition")||e.includes("Optimal")?"check-circle":"help-circle"}function onMouseMove(e){if(IS_MOBILE)return;const t=document.getElementById("tooltip");if(t&&(t.style.left=`${e.clientX}px`,t.style.top=`${e.clientY}px`),outOfFundsVisible){if(hoveredMesh&&hoveredMesh!==clickedMesh){hoveredMesh.userData.originalMaterial&&(hoveredMesh.material&&hoveredMesh.material.dispose(),hoveredMesh.material=hoveredMesh.userData.originalMaterial.clone(),void 0!==hoveredMesh.userData.originalCastShadow&&(hoveredMesh.castShadow=hoveredMesh.userData.originalCastShadow,hoveredMesh.userData.originalCastShadow=void 0),hoveredMesh.userData.originalMaterial=null),boundingBoxHelper&&boundingBoxHelper.parent&&(boundingBoxHelper.parent.remove(boundingBoxHelper),boundingBoxHelper=null),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerIndicators=[],cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>{e&&e.parentNode&&labelsLayerEl.removeChild(e)}),cornerLabels=[],hoverPointLight&&(scene.remove(hoverPointLight),hoverPointLight.dispose?.(),hoverPointLight=null,hoverLightOwner=null),t&&t.classList.remove("visible");const e=document.getElementById("cursor-cross");e&&e.classList.remove("hovering","warning","good","neutral"),hoveredMesh=null,hoverFadeProgress=0}}else{if(porscheHistoryVisible){const o=document.getElementById("cursor-cross");o&&o.classList.remove("hovering","warning","good","neutral");const n=document.getElementById("porsche-history-container");if(n){const t=window.innerWidth/2,o=window.innerHeight/2,i=(e.clientX-t)/t,r=(e.clientY-o)/o;porscheHistoryMouseFollow.targetX=i*MENU_MOUSE_FOLLOW_STRENGTH,porscheHistoryMouseFollow.targetY=r*MENU_MOUSE_FOLLOW_STRENGTH;const a=window.gsap||window.GSAP;a&&(porscheHistoryFollowAnimation&&porscheHistoryFollowAnimation.kill(),porscheHistoryFollowAnimation=a.to(porscheHistoryMouseFollow,{x:porscheHistoryMouseFollow.targetX,y:porscheHistoryMouseFollow.targetY,duration:.3,ease:"power2.out",onUpdate:()=>{const e=a.getProperty(n,"y")||0;n.style.transform=`translate(calc(-50% + ${porscheHistoryMouseFollow.x}px), calc(-50% + ${e+porscheHistoryMouseFollow.y}px))`;const t=document.getElementById("porsche-history-scrollbar");if(t&&"none"!==t.style.display){const e=n.getBoundingClientRect();t.style.left=`${e.right+4}px`}}}))}if(hoveredMesh&&hoveredMesh!==clickedMesh){hoveredMesh.userData.originalMaterial&&(hoveredMesh.material&&hoveredMesh.material.dispose(),hoveredMesh.material=hoveredMesh.userData.originalMaterial.clone(),void 0!==hoveredMesh.userData.originalCastShadow&&(hoveredMesh.castShadow=hoveredMesh.userData.originalCastShadow,hoveredMesh.userData.originalCastShadow=void 0),hoveredMesh.userData.originalMaterial=null),boundingBoxHelper&&boundingBoxHelper.parent&&(boundingBoxHelper.parent.remove(boundingBoxHelper),boundingBoxHelper=null),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerIndicators=[],cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>{e&&e.parentNode&&labelsLayerEl.removeChild(e)}),cornerLabels=[],hoverPointLight&&(scene.remove(hoverPointLight),hoverPointLight.dispose?.(),hoverPointLight=null,hoverLightOwner=null),t&&t.classList.remove("visible");const e=document.getElementById("cursor-cross");e&&e.classList.remove("hovering","warning","good","neutral"),hoveredMesh=null,hoverFadeProgress=0}return}if(menuVisible){const o=document.getElementById("cursor-cross");o&&o.classList.remove("hovering","warning","good","neutral");const n=document.getElementById("part-menu-container");if(n){const t=window.innerWidth/2,o=window.innerHeight/2,i=(e.clientX-t)/t,r=(e.clientY-o)/o;menuMouseFollow.targetX=i*MENU_MOUSE_FOLLOW_STRENGTH,menuMouseFollow.targetY=r*MENU_MOUSE_FOLLOW_STRENGTH;const a=window.gsap||window.GSAP;a&&(menuFollowAnimation&&menuFollowAnimation.kill(),menuFollowAnimation=a.to(menuMouseFollow,{x:menuMouseFollow.targetX,y:menuMouseFollow.targetY,duration:.3,ease:"power2.out",onUpdate:()=>{const e=a.getProperty(n,"y")||0;n.style.transform=`translate(calc(-50% + ${menuMouseFollow.x}px), calc(-50% + ${e+menuMouseFollow.y}px))`}}))}if(hoveredMesh&&hoveredMesh!==clickedMesh){hoveredMesh.userData.originalMaterial&&(hoveredMesh.material&&hoveredMesh.material.dispose(),hoveredMesh.material=hoveredMesh.userData.originalMaterial.clone(),void 0!==hoveredMesh.userData.originalCastShadow&&(hoveredMesh.castShadow=hoveredMesh.userData.originalCastShadow,hoveredMesh.userData.originalCastShadow=void 0),hoveredMesh.userData.originalMaterial=null),boundingBoxHelper&&boundingBoxHelper.parent&&(boundingBoxHelper.parent.remove(boundingBoxHelper),boundingBoxHelper=null),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerIndicators=[],cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>{e&&e.parentNode&&labelsLayerEl.removeChild(e)}),cornerLabels=[],hoverPointLight&&(scene.remove(hoverPointLight),hoverPointLight.dispose?.(),hoverPointLight=null,hoverLightOwner=null),t&&t.classList.remove("visible");const e=document.getElementById("cursor-cross");e&&e.classList.remove("hovering","warning","good","neutral"),hoveredMesh=null,hoverFadeProgress=0}return}if(mouseX=e.clientX/window.innerWidth*2-1,mouseY=-e.clientY/window.innerHeight*2+1,mouse.x=mouseX,mouse.y=mouseY,raycaster.setFromCamera(mouse,camera),porscheModel){const e=raycaster.intersectObject(porscheModel,!0).find(e=>function(e){if(!e||!e.isMesh)return!1;let t=e;for(;t;){if(t.userData?.isHelper)return!1;const e=(t.name||"").toLowerCase();if(e.includes("reference")||e.includes("ghostpointcloud")||e.includes("bounding")||e.includes("hoverlight")||e.includes("podium"))return!1;if(t===orbitsGroup||t===scatteredCrossGroup)return!1;t=t.parent}const o=(new THREE.Box3).setFromObject(e),n=o.getSize(new THREE.Vector3),i=o.getCenter(new THREE.Vector3),r=Math.max(n.x,n.y,n.z),a=i.length()<.05*modelMaxDimension,s=r<.03*modelMaxDimension,l=e.geometry,c=l?.attributes?.position?.count||0;return!(a&&s||c>0&&c<30)}(e.object));document.getElementById("cursor-cross");if(e){const t=e.object;if(t.name&&t.name.toLowerCase().includes("plateau")){if(hoveredMesh&&hoveredMesh.userData.originalMaterial){hoveredMesh.material&&hoveredMesh.material.dispose();const e=hoveredMesh.userData.originalMaterial.clone();hoveredMesh.material=e,void 0!==hoveredMesh.userData.originalCastShadow&&(hoveredMesh.castShadow=hoveredMesh.userData.originalCastShadow,hoveredMesh.userData.originalCastShadow=void 0),hoveredMesh.userData.originalMaterial=null}boundingBoxHelper&&boundingBoxHelper.parent&&(boundingBoxHelper.parent.remove(boundingBoxHelper),boundingBoxHelper=null),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>labelsLayerEl.removeChild(e)),cornerLabels=[],cornerIndicators=[],hoverPointLight&&(scene.remove(hoverPointLight),hoverPointLight.dispose?.(),hoverPointLight=null,hoverLightOwner=null,cleanupHoverLights());const e=document.getElementById("cursor-cross");e&&e.classList.remove("hovering","warning","good","neutral"),targetText="",currentText="",textDecodeIndex=0;const t=document.getElementById("tooltip");if(t){t.classList.remove("visible"),tooltipTypewriterActive=!1,tooltipCurrentText="",tooltipTargetText="",tooltipTypewriterIndex=0;const e=document.getElementById("tooltip-status"),o=document.getElementById("tooltip-icon");e&&e.classList.remove("blinking"),o&&(o.classList.remove("blinking","warning","good"),o.innerHTML="")}const o=document.getElementById("part-container");o&&o.classList.remove("visible");const n=document.getElementById("part-name");return n&&n.classList.remove("warning","good"),hoveredMesh=null,void(hoverFadeProgress=0)}if(t!==hoveredMesh){t.name;let e;const o=t.uuid.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),n=Math.abs(o)%3;if(0===n){const t=["Status: Operational","Status: Excellent","Status: Good Condition","Status: Optimal Performance"];e=t[Math.abs(o)%t.length]}else if(1===n){const t=["Status: Requires Maintenance","Status: Warning - Check Soon"];e=t[Math.abs(o)%t.length]}else{const t=["Status: Needs Inspection","Status: Minor Wear"];e=t[Math.abs(o)%t.length]}const i=document.getElementById("tooltip"),r=document.getElementById("tooltip-part-name"),a=document.getElementById("tooltip-status"),s=document.getElementById("tooltip-icon");if(i&&r&&a&&s){i.classList.add("visible"),r.style.display="inline-block",r.style.transform="scale(1.2)",r.style.transformOrigin="left center",tooltipTargetText=capitalizeFirstLetter(t.name||"Unknown Part"),tooltipCurrentText="",tooltipTypewriterIndex=0,tooltipTypewriterActive=!0,r.classList.remove("warning","good"),e.includes("Maintenance")||e.includes("Warning")?(r.classList.add("warning"),a.classList.add("blinking"),s.classList.add("blinking")):e.includes("Operational")||e.includes("Excellent")||e.includes("Good Condition")||e.includes("Optimal")?(r.classList.add("good"),a.classList.remove("blinking"),s.classList.remove("blinking"),a.style.opacity="1",s.style.opacity="1"):(a.classList.remove("blinking"),s.classList.remove("blinking"),a.style.opacity="1",s.style.opacity="1"),a.textContent=e,a.classList.remove("warning","good");const o=getStatusIcon(e);s.innerHTML=`<i data-feather="${o}"></i>`,s.classList.remove("warning","good"),e.includes("Maintenance")||e.includes("Warning")?s.classList.add("warning"):(e.includes("Operational")||e.includes("Excellent")||e.includes("Good Condition")||e.includes("Optimal"))&&s.classList.add("good"),"undefined"!=typeof feather&&feather.replace();const n=document.getElementById("cursor-cross");n&&(n.classList.remove("warning","good","neutral","hovering"),e.includes("Maintenance")||e.includes("Warning")?(a.classList.add("warning"),n.classList.add("warning")):e.includes("Operational")||e.includes("Excellent")||e.includes("Good Condition")||e.includes("Optimal")?(a.classList.add("good"),n.classList.add("good")):n.classList.add("neutral"))}if(hoveredMesh&&hoveredMesh.userData.originalMaterial){hoveredMesh.userData.originalMaterial;Array.isArray(hoveredMesh.material)?hoveredMesh.material.forEach((e,t)=>{hoveredMesh.userData.originalMaterial[t]&&(e.dispose(),e=hoveredMesh.userData.originalMaterial[t].clone())}):(hoveredMesh.material.dispose(),hoveredMesh.material=hoveredMesh.userData.originalMaterial.clone(),void 0!==hoveredMesh.userData.originalCastShadow&&(hoveredMesh.castShadow=hoveredMesh.userData.originalCastShadow,hoveredMesh.userData.originalCastShadow=void 0),hoveredMesh.material.isMeshPhysicalMaterial&&(hoveredMesh.material.envMap=scene.environment,hoveredMesh.material.envMapIntensity=1.2,hoveredMesh.material.roughness=0,hoveredMesh.material.metalness=1,hoveredMesh.material.sheen=2.5,hoveredMesh.material.sheenRoughness=.3,hoveredMesh.material.sheenColor=new THREE.Color(16766720),hoveredMesh.material.iridescence=1,hoveredMesh.material.iridescenceIOR=1.3,hoveredMesh.material.iridescenceThicknessRange=[100,500],hoveredMesh.material.needsUpdate=!0))}if(hoveredMesh=t,hoveredMesh.isMesh&&hoveredMesh.material){hoveredMesh.userData.originalMaterial=hoveredMesh.material.clone(),hoverSound.currentTime=0,hoverSound.play().catch(e=>console.log("Sound playback failed:",e));const t=document.getElementById("part-container"),o=document.getElementById("part-name");o&&(targetText="Porsche 911",currentText="",textDecodeIndex=0,o.classList.remove("warning","good")),t&&infoPanelEnabled&&t.classList.add("visible");const n=document.getElementById("part-info");if(n){const e=[];if(e.push("─────────────────────────────────────────"),e.push("  PART NAME:"),e.push(`    ${capitalizeFirstLetter(hoveredMesh.name||"Unnamed Part")}`),e.push("─────────────────────────────────────────"),e.push("  POSITION:"),e.push(`    x: ${hoveredMesh.position.x.toFixed(2)}`),e.push(`    y: ${hoveredMesh.position.y.toFixed(2)}`),e.push(`    z: ${hoveredMesh.position.z.toFixed(2)}`),e.push(""),e.push("  ROTATION:"),e.push(`    x: ${hoveredMesh.rotation.x.toFixed(2)}`),e.push(`    y: ${hoveredMesh.rotation.y.toFixed(2)}`),e.push(`    z: ${hoveredMesh.rotation.z.toFixed(2)}`),e.push(""),e.push("  SCALE:"),e.push(`    x: ${hoveredMesh.scale.x.toFixed(2)}`),e.push(`    y: ${hoveredMesh.scale.y.toFixed(2)}`),e.push(`    z: ${hoveredMesh.scale.z.toFixed(2)}`),hoveredMesh.geometry){const t=hoveredMesh.geometry;if(e.push("─────────────────────────────────────────"),e.push("  GEOMETRY TYPE:"),e.push(`    ${t.type}`),t.attributes&&t.attributes.position){const o=t.attributes.position.count,n=t.index?t.index.count/3:o/3;e.push(""),e.push(`  VERTICES: ${o}`),e.push(`  FACES: ${n.toFixed(0)}`)}if(t.boundingBox){const o=(t.boundingBox.max.x-t.boundingBox.min.x).toFixed(2),n=(t.boundingBox.max.y-t.boundingBox.min.y).toFixed(2),i=(t.boundingBox.max.z-t.boundingBox.min.z).toFixed(2);e.push(""),e.push("  BOUNDING BOX:"),e.push(`    w: ${o}`),e.push(`    h: ${n}`),e.push(`    d: ${i}`)}}hoveredMesh.material&&(e.push("─────────────────────────────────────────"),e.push(`  MATERIAL: ${hoveredMesh.material.type}`)),e.push("─────────────────────────────────────────"),e.push(`  UUID: ${hoveredMesh.uuid.substring(0,8)}...`),e.push("─────────────────────────────────────────"),n.innerHTML="";const t=.5/e.length;e.forEach((e,o)=>{const i=document.createElement("div");i.className="info-line",i.textContent=e,i.style.animationDelay=o*t+"s",n.appendChild(i)})}let i=16766720;e.includes("Maintenance")||e.includes("Warning")?i=16729156:(e.includes("Operational")||e.includes("Excellent")||e.includes("Good Condition")||e.includes("Optimal"))&&(i=4521796);const r=new THREE.MeshStandardMaterial({color:i,wireframe:!0,emissive:i,emissiveIntensity:7.5});if(void 0===hoveredMesh.userData.originalCastShadow&&(hoveredMesh.userData.originalCastShadow=hoveredMesh.castShadow),hoveredMesh.material=r,hoveredMesh.castShadow=!1,boundingBoxHelper&&boundingBoxHelper.parent.remove(boundingBoxHelper),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>labelsLayerEl.removeChild(e)),cornerLabels=[],cornerIndicators=[],hoveredMesh.geometry){hoveredMesh.geometry.computeBoundingBox();const e=hoveredMesh.geometry.boundingBox,t=e.getCenter(new THREE.Vector3),o=new THREE.BoxGeometry(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),n=i,r=new THREE.EdgesGeometry(o),a=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:n,transparent:!0,opacity:1,linewidth:3}));a.raycast=()=>{},a.position.copy(t),hoveredMesh.add(a),boundingBoxHelper=a,boundingBoxHelper.scale.set(0,0,0),startBoundingBoxAnimation();{const e=(new THREE.Box3).setFromObject(hoveredMesh),t=(e.getCenter(new THREE.Vector3),e.getSize(new THREE.Vector3)),o=Math.max(t.x,t.y,t.z),n=1.2*Math.max(2,4*o),r=.8;cleanupHoverLights(),hoverPointLight||(hoverPointLight=new THREE.PointLight(i,r,n),hoverPointLight.castShadow=!1,hoverPointLight.decay=2,hoverPointLight.userData.isHoverLight=!0,hoverPointLight.name="HoverLight"),hoverPointLight.parent!==hoveredMesh&&(hoverPointLight.parent&&hoverPointLight.parent.remove(hoverPointLight),hoveredMesh.add(hoverPointLight),hoverLightOwner=hoveredMesh),hoverPointLight.color.setHex(i);const a=performance.now();if(hoverLightOwner!==hoveredMesh||a-hoverLightLastUpdate>100){hoverPointLight.intensity=r,hoverPointLight.distance=n;const e=getStableLocalCenter(hoveredMesh);hoverPointLight.position.copy(e),hoverLightLastUpdate=a}}[new THREE.Vector3(e.min.x,e.min.y,e.min.z),new THREE.Vector3(e.max.x,e.min.y,e.min.z),new THREE.Vector3(e.min.x,e.max.y,e.min.z),new THREE.Vector3(e.max.x,e.max.y,e.min.z),new THREE.Vector3(e.min.x,e.min.y,e.max.z),new THREE.Vector3(e.max.x,e.min.y,e.max.z),new THREE.Vector3(e.min.x,e.max.y,e.max.z),new THREE.Vector3(e.max.x,e.max.y,e.max.z)].forEach(t=>{e.getCenter(new THREE.Vector3);const o=t.clone(),i=.0375,r=[o.clone(),o.clone().add(new THREE.Vector3(i,0,0)),o.clone(),o.clone().add(new THREE.Vector3(-.0375,0,0)),o.clone(),o.clone().add(new THREE.Vector3(0,i,0)),o.clone(),o.clone().add(new THREE.Vector3(0,-.0375,0)),o.clone(),o.clone().add(new THREE.Vector3(0,0,i)),o.clone(),o.clone().add(new THREE.Vector3(0,0,-.0375))],a=new THREE.LineBasicMaterial({color:n,transparent:!0,opacity:1,linewidth:3}),s=(new THREE.BufferGeometry).setFromPoints(r),l=new THREE.LineSegments(s,a);l.position.set(0,0,0),l.raycast=()=>{},l.scale.set(0,0,0),hoveredMesh.add(l),cornerIndicators.push(l),boundingBoxAnimation.cornerIndicators.push(l),labelsLayerEl||(labelsLayerEl=document.getElementById("labels-layer"),labelsLayerEl||(labelsLayerEl=document.createElement("div"),labelsLayerEl.id="labels-layer",labelsLayerEl.style.position="fixed",labelsLayerEl.style.left="0",labelsLayerEl.style.top="0",labelsLayerEl.style.width="100%",labelsLayerEl.style.height="100%",labelsLayerEl.style.pointerEvents="none",document.body.appendChild(labelsLayerEl)));const c=new THREE.Object3D;c.position.copy(o),hoveredMesh.add(c);const d=document.createElement("div");d.className="corner-label",d.style.position="absolute",d.style.transform="translate(-50%, -50%)",d.style.fontFamily="monospace",d.style.fontSize="11px";const u="#"+("000000"+n.toString(16)).slice(-6);d.style.color=u,d.style.background="transparent",d.style.padding="0",d.style.borderRadius="0",d.style.whiteSpace="nowrap",labelsLayerEl.appendChild(d);const h={anchor:c,el:d};cornerLabels.push(h),boundingBoxAnimation.cornerLabels||(boundingBoxAnimation.cornerLabels=[]),boundingBoxAnimation.cornerLabels.push(h)}),lockRing&&lockRing.material&&(lockRingAnim.active=!0,lockRingAnim.startTime=performance.now(),lockRingAnim.fromScale=Math.max(lockRing.scale.x||1,1.15),lockRingAnim.toScale=1,lockRingAnim.fromThick=lockRingThickness,lockRingAnim.toThick=.03,lockRingAnim.fromOpacity=lockRing.material.opacity,lockRingAnim.toOpacity=1,lockRing.material.color.setHex(i),lockRing.material.needsUpdate=!0)}}}}else{const e=document.getElementById("tooltip");if(e){e.classList.remove("visible"),tooltipTypewriterActive=!1,tooltipCurrentText="",tooltipTargetText="",tooltipTypewriterIndex=0;const t=document.getElementById("tooltip-status"),o=document.getElementById("tooltip-icon"),n=document.getElementById("tooltip-part-name");t&&t.classList.remove("blinking"),o&&(o.classList.remove("blinking","warning","good"),o.innerHTML=""),n&&(n.style.transform="")}if(hoveredMesh&&hoveredMesh.userData.originalMaterial){hoveredMesh.material&&hoveredMesh.material.dispose();const e=hoveredMesh.userData.originalMaterial.clone();hoveredMesh.material=e,hoveredMesh.userData.originalMaterial=null}if(lockRing){lockRingAnim.active=!1,lockRing.scale.set(1,1,1),lockRingThickness=.02;const e=lockRing.userData.baseRadius||1,t=e*(1-lockRingThickness),o=e,n=128,i=new THREE.RingGeometry(t,o,n);lockRing.geometry.dispose(),lockRing.geometry=i,lockRing.material.opacity=0,lockRing.material.color.setHex(16766720),lockRing.material.needsUpdate=!0}boundingBoxHelper&&boundingBoxHelper.parent&&(boundingBoxHelper.parent.remove(boundingBoxHelper),boundingBoxHelper=null),cornerIndicators.forEach(e=>{e.parent&&e.parent.remove(e)}),cornerLabels.length&&labelsLayerEl&&cornerLabels.forEach(({el:e})=>labelsLayerEl.removeChild(e)),cornerLabels=[],cornerIndicators=[],hoverPointLight&&(scene.remove(hoverPointLight),hoverPointLight.dispose?.(),hoverPointLight=null,hoverLightOwner=null,cleanupHoverLights());const t=document.getElementById("cursor-cross");t&&t.classList.remove("hovering","warning","good","neutral"),targetText="",currentText="",textDecodeIndex=0;const o=document.getElementById("part-container");o&&o.classList.remove("visible");const n=document.getElementById("part-name");n&&n.classList.remove("warning","good"),hoveredMesh=null,hoverFadeProgress=0}}}}hoverSound.preload="auto",hoverSound.crossOrigin="anonymous",document.addEventListener("click",()=>{hoverSound.play().then(()=>{hoverSound.pause(),hoverSound.currentTime=0}).catch(e=>console.log("Initial audio test:",e))},{once:!0}),IS_MOBILE||window.addEventListener("mousemove",onMouseMove);let clickedMesh=null,menuVisible=!1,menuMouseFollow={x:0,y:0,targetX:0,targetY:0},menuFollowAnimation=null;const MENU_MOUSE_FOLLOW_STRENGTH=15;let porscheHistoryMouseFollow={x:0,y:0,targetX:0,targetY:0},porscheHistoryFollowAnimation=null,autoRotateStateBeforeMenu=!0,clickedMeshOriginalMaterial=null,cameraOriginalState={position:new THREE.Vector3,target:new THREE.Vector3,saved:!1},cameraFocusAnimation=null,mouseDownPos={x:0,y:0},mouseDownTime=0;const CLICK_THRESHOLD=CONFIG.CLICK.THRESHOLD,CLICK_MAX_TIME=CONFIG.CLICK.MAX_TIME;function onMouseDown(e){0===e.button&&(mouseDownPos.x=e.clientX,mouseDownPos.y=e.clientY,mouseDownTime=Date.now(),isDragging=!1)}function checkDrag(e){if(0===mouseDownTime)return!1;const t=e.clientX-mouseDownPos.x,o=e.clientY-mouseDownPos.y;return Math.sqrt(t*t+o*o)>CLICK_THRESHOLD&&(isDragging=!0,!0)}function onMouseClick(e){if(IS_MOBILE)return;const t=e.target;if(t.closest("#part-menu-overlay")||t.closest("#porsche-history-overlay")||t.closest("#out-of-funds-overlay")||t.closest("#music-player")||t.closest("#fullscreen-button")||t.closest("#info-button")||t.closest("#rotate-button")||t.closest("#book-button"))return"part-menu-backdrop"===t.id&&hidePartMenu(),"porsche-history-backdrop"===t.id&&hidePorscheHistory(),"out-of-funds-backdrop"===t.id&&hideOutOfFundsPopup(),mouseDownTime=0,void(isDragging=!1);if(menuVisible)return mouseDownTime=0,void(isDragging=!1);let o=0,n=0;if(mouseDownTime>0){o=Date.now()-mouseDownTime;const t=e.clientX-mouseDownPos.x,i=e.clientY-mouseDownPos.y;n=Math.sqrt(t*t+i*i)}const i=mouseDownTime>0&&(isDragging||n>CLICK_THRESHOLD||o>CLICK_MAX_TIME)||cameraIsBeingRotated;if(mouseDownTime=0,i){isDragging=!1;const e=Date.now()-lastCameraRotationTime;return void console.log("Click blocked:",{isDragging:isDragging,distance:n,timeSinceDown:o,cameraIsBeingRotated:cameraIsBeingRotated,timeSinceRotation:e})}if(mouse.x=e.clientX/window.innerWidth*2-1,mouse.y=-e.clientY/window.innerHeight*2+1,raycaster.setFromCamera(mouse,camera),porscheModel){const e=raycaster.intersectObject(porscheModel,!0);const t=e.find(e=>function(e){if(!e||!e.isMesh)return!1;let t=e;for(;t;){if(t.userData?.isHelper)return!1;const e=(t.name||"").toLowerCase();if(e.includes("reference")||e.includes("ghostpointcloud")||e.includes("bounding")||e.includes("hoverlight")||e.includes("podium"))return!1;if(t===orbitsGroup||t===scatteredCrossGroup)return!1;t=t.parent}const o=(new THREE.Box3).setFromObject(e),n=o.getSize(new THREE.Vector3),i=o.getCenter(new THREE.Vector3),r=Math.max(n.x,n.y,n.z),a=i.length()<.05*modelMaxDimension,s=r<.03*modelMaxDimension,l=e.geometry,c=l?.attributes?.position?.count||0;return!(a&&s||c>0&&c<30)}(e.object));t?(clickedMesh=t.object,console.log("Valid click detected on:",clickedMesh.name),showPartMenu(clickedMesh)):console.log("Click detected but no valid mesh found. Total intersects:",e.length)}}function getPartMenuOptions(e){const t=e.name||"Unknown Part",o=e.uuid.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),n=Math.abs(o)%3,i=[{title:"View Details",desc:"Inspect part specifications and status",action:()=>console.log("View details:",t)},{title:"Maintenance History",desc:"View service records and maintenance log",action:()=>console.log("Maintenance history:",t)},{title:"Replace Part",desc:"Order replacement or schedule installation",action:()=>console.log("Replace part:",t)}];return 1===n?i.unshift({title:"⚠️ Immediate Action Required",desc:"This part requires urgent attention",action:()=>console.log("Urgent action:",t)}):0===n&&i.push({title:"Optimize Performance",desc:"Enhance part efficiency and longevity",action:()=>console.log("Optimize:",t)}),i}function showPartMenu(e){const t=window.gsap||window.GSAP;if(!t)return void console.warn("GSAP not loaded");if(autoRotateStateBeforeMenu=autoRotateEnabled,autoRotateEnabled=!1,cameraOriginalState.saved||(cameraOriginalState.position.copy(camera.position),cameraOriginalState.target.copy(controls.target),cameraOriginalState.saved=!0),e&&e.isMesh){const o=(new THREE.Box3).setFromObject(e),n=o.getCenter(new THREE.Vector3),i=o.getSize(new THREE.Vector3),r=Math.max(i.x,i.y,i.z),a=r>.001?r:1,s=camera.position.distanceTo(n);let l=n.clone().sub(camera.position).clone().normalize();(!l.length()||!Number.isFinite(l.x)||Math.abs(l.length())<.1)&&l.set(.3,.5,1).normalize();const c=2.5*a,d=Math.min(.6*s,Math.max(c,.6*s)),u=Math.min(d,.9*s),h=n.clone().sub(l.multiplyScalar(u));cameraFocusAnimation&&cameraFocusAnimation.kill();const m={x:camera.position.x,y:camera.position.y,z:camera.position.z},p={x:controls.target.x,y:controls.target.y,z:controls.target.z},g={x:h.x,y:h.y,z:h.z},y={x:n.x,y:n.y,z:n.z},f=t.timeline();f.to(m,{x:g.x,y:g.y,z:g.z,duration:1,ease:"power2.inOut",onUpdate:()=>{Number.isFinite(m.x)&&Number.isFinite(m.y)&&Number.isFinite(m.z)&&(camera.position.set(m.x,m.y,m.z),camera.updateProjectionMatrix())}},0).to(p,{x:y.x,y:y.y,z:y.z,duration:1,ease:"power2.inOut",onUpdate:()=>{Number.isFinite(p.x)&&Number.isFinite(p.y)&&Number.isFinite(p.z)&&(controls.target.set(p.x,p.y,p.z),controls.update())}},0),cameraFocusAnimation=f}if(e&&e.isMesh&&e.material){clickedMeshOriginalMaterial||(clickedMeshOriginalMaterial=e.userData.originalMaterial?e.userData.originalMaterial.clone():e.material.clone());const t=e.uuid.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),o=Math.abs(t)%3;let n=16766720;1===o?n=16729156:0===o&&(n=4521796);const i=e.material;let r=!0;if(i.emissive&&i.emissiveIntensity&&i.emissive.getHex()===n&&Math.abs(i.emissiveIntensity-7.5)<.1&&(r=!1),r){const t=i.wireframe,o=t?new THREE.MeshStandardMaterial({color:n,wireframe:!0,emissive:n,emissiveIntensity:7.5}):i.clone();t||(o.emissive=new THREE.Color(n),o.emissiveIntensity=7.5),i.dispose&&i.dispose(),t&&(void 0===e.userData.originalCastShadow&&(e.userData.originalCastShadow=e.castShadow),e.castShadow=!1),e.material=o}}menuVisible=!0,document.body.classList.add("menu-open");const o=document.getElementById("cursor-cross");o&&o.classList.remove("hovering","warning","good","neutral");const n=document.getElementById("tooltip");n&&n.classList.remove("visible");const i=document.getElementById("part-menu-overlay"),r=document.getElementById("part-menu-container"),a=document.getElementById("part-menu-title"),s=document.getElementById("part-menu-options"),l=document.getElementById("part-menu-backdrop"),c=document.getElementById("part-menu-close");if(menuFollowAnimation&&(menuFollowAnimation.kill(),menuFollowAnimation=null),menuMouseFollow.x=0,menuMouseFollow.y=0,menuMouseFollow.targetX=0,menuMouseFollow.targetY=0,!(i&&r&&a&&s))return void console.warn("Menu elements not found",{overlay:i,container:r,title:a,optionsContainer:s});console.log("Showing menu for:",e.name);const d=e.name||"Unknown Part";a.textContent=d;const u=getPartMenuOptions(e);s.innerHTML="",u.forEach((e,t)=>{const o=document.createElement("div");o.className="part-menu-option",(e.title.includes("⚠️")||e.title.includes("Immediate Action"))&&o.classList.add("warning-option");let n=e.title;e.title.includes("⚠️")&&(n=e.title.replace("⚠️",'<span class="warning-icon-wrapper"><i data-feather="alert-triangle" class="warning-icon-feather"></i></span>')),o.innerHTML=`\n            <div class="part-menu-option-title">${n}</div>\n            <div class="part-menu-option-desc">${e.desc}</div>\n        `,"undefined"!=typeof feather&&feather.replace(),o.addEventListener("mouseenter",()=>{createUISound("hover")}),o.addEventListener("click",()=>{e.action();const t=window.gsap||window.GSAP;if(t){const e=t.timeline({onComplete:()=>{hidePartMenu()}});for(let t=0;t<3;t++)e.to(o,{opacity:0,duration:.05,ease:"none"}).call(()=>createUISound("select")).to(o,{opacity:1,duration:.05,ease:"none"})}else hidePartMenu()}),s.appendChild(o)}),c.onclick=()=>hidePartMenu(),l.onclick=e=>{e.target===l&&hidePartMenu()};const h=document.getElementById("part-container"),m=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[h,...m].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),h&&t.to(h,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0}),m.forEach(e=>{e&&t.to(e,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&t.to(uiCogMesh.material,{opacity:0,duration:.3,ease:"power2.out"}),i.classList.add("visible"),t.set(i,{opacity:1}),t.fromTo(l,{opacity:0},{opacity:1,duration:.3,ease:"power2.out"}),t.set(r,{clipPath:"inset(0% 0% 100% 0%)",y:-50}),t.to(r,{clipPath:"inset(0% 0% 0% 0%)",y:0,duration:.25,ease:"circ.out"});const p=s.querySelectorAll(".part-menu-option");p.forEach((e,o)=>{t.set(e,{opacity:0,y:-20}),t.to(e,{opacity:1,y:0,duration:.3,delay:0+.08*o,ease:"power1.out"});t.timeline({delay:0+.08*o}).set(e,{backgroundColor:"#ffd700"}).to(e,{duration:.1,backgroundColor:"rgba(255, 215, 0, 0.05)"})}),p.forEach((e,o)=>{setTimeout(()=>{t.set(e,{clearProps:"backgroundColor"})},1e3*(0+.08*o+.4))})}function hidePartMenu(){const e=window.gsap||window.GSAP;if(!e)return;const t=document.getElementById("part-menu-overlay"),o=document.getElementById("part-menu-container"),n=document.getElementById("part-menu-backdrop"),i=document.getElementById("part-menu-options");if(!t||!o)return;const r=i.querySelectorAll(".part-menu-option");e.to(r,{opacity:0,y:-10,duration:.2,stagger:.03,ease:"power2.in"}),e.to(o,{clipPath:"inset(0% 0% 100% 0%)",y:0,duration:.4,ease:"power2.in",onComplete:()=>{if(t.classList.remove("visible"),menuVisible=!1,document.body.classList.remove("menu-open"),clickedMesh&&clickedMeshOriginalMaterial&&(clickedMesh!==hoveredMesh&&(clickedMesh.material&&clickedMesh.material.dispose&&clickedMesh.material.dispose(),clickedMesh.material=clickedMeshOriginalMaterial.clone(),void 0!==clickedMesh.userData.originalCastShadow&&(clickedMesh.castShadow=clickedMesh.userData.originalCastShadow,clickedMesh.userData.originalCastShadow=void 0)),clickedMeshOriginalMaterial=null),clickedMesh=null,cameraOriginalState.saved){const t={x:camera.position.x,y:camera.position.y,z:camera.position.z},o={x:controls.target.x,y:controls.target.y,z:controls.target.z};cameraFocusAnimation&&cameraFocusAnimation.kill(),e.to(t,{x:cameraOriginalState.position.x,y:cameraOriginalState.position.y,z:cameraOriginalState.position.z,duration:1,ease:"power2.inOut",onUpdate:()=>{camera.position.set(t.x,t.y,t.z),camera.updateProjectionMatrix()}}),e.to(o,{x:cameraOriginalState.target.x,y:cameraOriginalState.target.y,z:cameraOriginalState.target.z,duration:1,ease:"power2.inOut",onUpdate:()=>{controls.target.set(o.x,o.y,o.z),controls.update()},onComplete:()=>{cameraOriginalState.saved=!1,autoRotateEnabled=autoRotateStateBeforeMenu;const t=document.getElementById("part-container"),o=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[t,...o].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),t&&infoPanelEnabled&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0}),o.forEach(t=>{t&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:1,duration:.3,ease:"power2.out"})}})}else{autoRotateEnabled=autoRotateStateBeforeMenu;const t=document.getElementById("part-container"),o=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[t,...o].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),t&&infoPanelEnabled&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0}),o.forEach(t=>{t&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:1,duration:.3,ease:"power2.out"})}const o=document.getElementById("part-menu-container");menuFollowAnimation&&(menuFollowAnimation.kill(),menuFollowAnimation=null),o&&(o.style.transform="translate(-50%, -50%)"),menuMouseFollow.x=0,menuMouseFollow.y=0,menuMouseFollow.targetX=0,menuMouseFollow.targetY=0}}),e.to(n,{opacity:0,duration:.3})}IS_MOBILE||window.addEventListener("mousedown",onMouseDown),IS_MOBILE||window.addEventListener("click",onMouseClick),window.addEventListener("keydown",e=>{"Escape"===e.key&&menuVisible&&hidePartMenu()});let porscheHistoryVisible=!1,outOfFundsVisible=!1;function showPorscheHistory(){const e=window.gsap||window.GSAP,t=document.getElementById("porsche-history-overlay"),o=document.getElementById("porsche-history-container"),n=document.getElementById("porsche-history-content"),i=document.getElementById("porsche-history-backdrop"),r=document.getElementById("porsche-history-close");if(!t||!o||!n)return void console.warn("Porsche history elements not found",{overlay:t,container:o,content:n});const a=document.getElementById("porsche-history-scrollbar");a&&(a.style.display="none"),porscheHistoryContainerReady=!1,console.log("Showing Porsche history popup");n.innerHTML='\n        <p><em>A Retrospective from 2077</em></p>\n        \n        <p>When we look back at the early 21st century, few automotive names carry the mythic weight that <strong>Porsche</strong> does. Long before vehicles became fully autonomous, connected, and post-combustion by default, Porsche represented something deeply human — the obsession with control, sensation, and sound.</p>\n        \n        <p>The cars weren\'t just machines. <strong>They were extensions of identity.</strong></p>\n        \n        <div class="porsche-history-fullwidth-image">\n            <video src="Media/ferdinand-animated.MP4" autoplay loop muted playsinline></video>\n            <div class="porsche-history-fullwidth-image-caption">Ferdinand Porsche (1875–1951) — engineer, innovator, and founder of Porsche.</div>\n        </div>\n        \n        <h3>The Age of the Driver (1930–2030)</h3>\n        \n        <p>Founded in 1931 by <strong>Ferdinand Porsche</strong>, the brand emerged from the same industrial fire that defined Europe between wars. The company\'s first masterpiece — the <strong>Volkswagen Beetle</strong> — wasn\'t even a Porsche model, but it established the lineage: simplicity, efficiency, and form following function.</p>\n        \n        <p>After World War II, Ferdinand\'s son <strong>Ferry Porsche</strong> decided to build something personal — a car for people who loved to drive, not just to move. The result was the <strong>Porsche 356 (1948)</strong>, a small, curved body of aluminum and spirit. It was light, quick, and soulful — and it marked the beginning of the Porsche legacy.</p>\n        \n        <p>But the myth didn\'t crystallize until 1964, when the <strong>Porsche 911</strong> appeared.</p>\n        \n        <p>The <strong>911</strong> was an anomaly: rear-engine, perfectly imperfect, but alive in the hands of those who understood it. Over the next century, it became one of humanity\'s longest-running design languages — a silhouette instantly recognizable even from orbiting colonies.</p>\n        \n        <div class="porsche-history-image-wrapper">\n            <div class="porsche-history-image"><img src="Media/p964.jpg" alt="Porsche 964" loading="lazy" decoding="async"></div>\n            <div class="porsche-history-image-caption">Porsche 964</div>\n        </div>\n        \n        <h3>Mechanical Religion</h3>\n        \n        <p>During the 20th and early 21st centuries, <strong>Porsche culture was almost spiritual.</strong> Owners gathered for early-morning drives through winding roads, chasing the sound of a flat-six engine echoing through forests or city tunnels.</p>\n        \n        <p>The <strong>911</strong> wasn\'t just a car; <strong>it was a ritual</strong> — a blend of engineering discipline and emotional release. Enthusiasts spoke of steering feedback, gear ratios, and throttle response with the reverence of monks describing sacred texts.</p>\n        \n        <div class="porsche-history-image-wrapper">\n            <div class="porsche-history-image"><img src="Media/p930.jpg" alt="Porsche 930 Turbo" loading="lazy" decoding="async"></div>\n            <div class="porsche-history-image-caption">Porsche 930 Turbo</div>\n        </div>\n        \n        <p>When electric cars began to take over in the 2020s, Porsche faced a crisis of identity. Many wondered: <strong>Could a silent Porsche still feel like a Porsche?</strong></p>\n        \n        <p>The answer arrived in 2019 with the <strong>Taycan</strong> — the company\'s first fully electric sports sedan. It was silent, but powerful; efficient, yet emotional. The Taycan\'s instant torque and precise steering reassured a generation that performance and sustainability could coexist. It became a transitional relic — the last breath of the combustion era meeting the first light of the electric age.</p>\n        \n        <h3>Cultural Symbolism</h3>\n        \n        <p>In the mid-century years, <strong>Porsche became shorthand for attainable perfection.</strong> Its slogan — <strong>"There is no substitute"</strong> — evolved into a cultural mantra representing mastery, focus, and emotional precision.</p>\n        \n        <p>The brand\'s design philosophy — clean, minimal, and purpose-driven — influenced not only car aesthetics but also architecture, industrial design, and digital interfaces. The timeless <strong>911 silhouette</strong> inspired furniture, fashion, and even the casings of AI robots in the 2060s.</p>\n        \n        <div class="porsche-history-image-wrapper">\n            <div class="porsche-history-image"><img src="Media/p918.jpg" alt="Porsche 918 Spyder" loading="lazy" decoding="async"></div>\n            <div class="porsche-history-image-caption">Porsche 918 Spyder</div>\n        </div>\n        \n        <p>Collectors treated early <strong>911s</strong>, <strong>918 Spyders</strong>, and <strong>992-series Taycans</strong> as sacred artifacts, preserving them in climate-controlled capsules long after gasoline was banned on most continents.</p>\n        \n        <h3>Racing and Legacy</h3>\n        \n        <p>Few brands blurred the line between the road and the racetrack like Porsche. Throughout the 20th and 21st centuries, it dominated endurance racing, especially the <strong>24 Hours of Le Mans</strong>, where it holds the record for most victories.</p>\n        \n        <div class="porsche-history-image-wrapper">\n            <div class="porsche-history-image"><img src="Media/plemans.jpg" alt="24 Hours of Le Mans" loading="lazy" decoding="async"></div>\n            <div class="porsche-history-image-caption">24 Hours of Le Mans</div>\n        </div>\n        \n        <p>In retrospect, those races were more than sport — they were engineering experiments in motion. Porsche\'s philosophy of <strong>"durability through precision"</strong> later influenced the mechanical design of early lunar rovers and orbital vehicles.</p>\n        \n        <h3>Post-Human Design (2030–2077)</h3>\n        \n        <p>As human driving faded from daily life, Porsche reinvented itself. By the 2040s, its vehicles had become <strong>augmented emotional machines</strong> — systems that combined human input with adaptive intelligence, tuned to mirror their driver\'s psychological state.</p>\n        \n        <div class="porsche-history-image-wrapper">\n            <div class="porsche-history-image"><video src="Media/pfuture-video.MP4" autoplay loop muted playsinline></video></div>\n            <div class="porsche-history-image-caption">Porsche 9000</div>\n        </div>\n        \n        <p>Even as control shifted from hands to algorithms, Porsche remained faithful to one principle: <strong>a machine can still be felt.</strong></p>\n        \n        <p>The final analog <strong>911s</strong> built in 2045 were celebrated as <strong>"The Last True Porsches,"</strong> hand-assembled tributes to a disappearing era of raw connection.</p>\n        \n        <p>By the 2070s, Porsche\'s influence lived on not through cars, but through <strong>design language and philosophy</strong> — a foundation for modern mobility systems, from hovercrafts to interplanetary transports.</p>\n        \n        <h3>Conclusion — Why Porsche Still Matters</h3>\n        \n        <p><strong>Porsche was never just a car company.</strong> It was a mirror of humanity\'s relationship with motion. It taught us that speed wasn\'t about getting somewhere faster — <strong>it was about feeling alive while getting there.</strong></p>\n        \n        <p style="margin-bottom: 62px;">Even in 2077, when roads are memories and vehicles glide silently across air, the shape of a <strong>911</strong> remains a reminder of what driving once meant: <strong>a dance between man, machine, and the horizon.</strong></p>\n        \n        <div class="porsche-history-stock-chart-separator"></div>\n        \n        <div class="porsche-history-stock-chart">\n            <div class="porsche-history-stock-chart-title">Market Performance (2077)</div>\n            <canvas id="porsche-stock-chart" width="800" height="200"></canvas>\n            <div class="porsche-history-stock-chart-legend">\n                <div class="porsche-history-stock-chart-legend-item">\n                    <div class="porsche-history-stock-chart-legend-line"></div>\n                    <span>P911</span>\n                </div>\n                <div class="porsche-history-stock-chart-legend-item">\n                    <div class="porsche-history-stock-chart-legend-line sp500"></div>\n                    <span>SP500</span>\n                </div>\n            </div>\n        </div>\n        \n        <div class="porsche-history-buttons">\n            <div class="porsche-history-done-button">I\'M DONE READING</div>\n            <div class="porsche-history-buy-button">BUY ONE</div>\n        </div>\n    ',n.scrollTop=0;const s=n.querySelector(".porsche-history-done-button"),l=n.querySelector(".porsche-history-buy-button");s&&(s.classList.remove("visible"),s.style.opacity="0",s.style.transform="translateY(10px)"),l&&(l.classList.remove("visible"),l.style.opacity="0",l.style.transform="translateY(10px)");n.querySelectorAll("p").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(20px)",e.style.clipPath="inset(0 100% 0 0)"});n.querySelectorAll(".porsche-history-image-placeholder").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(10px)"});n.querySelectorAll(".porsche-history-image").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(10px)"});n.querySelectorAll(".porsche-history-image-wrapper");n.querySelectorAll(".porsche-history-image-caption").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(10px)"});n.querySelectorAll("h3").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(20px)",e.style.clipPath="inset(0 100% 0 0)"});const c=document.getElementById("part-container"),d=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[c,...d].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),c&&e.to(c,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0}),d.forEach(t=>{t&&e.to(t,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:0,duration:.3,ease:"power2.out"}),t.classList.add("visible"),e.set(t,{opacity:1}),e.fromTo(i,{opacity:0},{opacity:1,duration:.3,ease:"power2.out"}),porscheHistoryMouseFollow.x=0,porscheHistoryMouseFollow.y=0,porscheHistoryMouseFollow.targetX=0,porscheHistoryMouseFollow.targetY=0;const u=document.getElementById("porsche-history-title");u&&e&&e.to(u,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}),e.set(o,{clipPath:"inset(0% 0% 100% 0%)",y:-50}),e.to(o,{clipPath:"inset(0% 0% 0% 0%)",y:0,duration:.25,ease:"circ.out",onUpdate:()=>{const t=e.getProperty(o,"y")||0;o.style.transform=`translate(calc(-50% + ${porscheHistoryMouseFollow.x}px), calc(-50% + ${t+porscheHistoryMouseFollow.y}px))`},onComplete:()=>{porscheHistoryContainerReady=!0,initPorscheHistoryScrollReveal()}}),porscheHistoryVisible=!0,document.body.classList.add("menu-open");const h=e=>{porscheHistoryVisible&&n&&(e.preventDefault(),e.stopPropagation(),n.scrollTop+=e.deltaY,n.dispatchEvent(new Event("scroll")))};window.addEventListener("wheel",h,{passive:!1,capture:!0}),window._porscheHistoryWheelHandler=h,r&&(r.onclick=()=>hidePorscheHistory()),i&&(i.onclick=e=>{e.target===i&&hidePorscheHistory()})}let stockChartAnimationFrame=null;function initStockChart(){const e=document.getElementById("porsche-stock-chart"),t=document.querySelector(".porsche-history-stock-chart-title"),o=document.querySelector(".porsche-history-stock-chart-legend");if(!e||!t)return;const n=e.getContext("2d"),i=e.parentElement;if(i){const t=i.getBoundingClientRect();e.width=t.width,e.height=Math.round(t.width*(9/16))}const r=e.width,a=e.height,s=20,l=20,c=30,d=40,u=r-d-l,h=a-s-c,m=[],p=[],g=[];let y=82.5,f=100;const v=[{year:2029,severity:.35},{year:2037,severity:.22},{year:2043,severity:.28},{year:2051,severity:.19},{year:2062,severity:.25},{year:2070,severity:.15}];for(let e=2022;e<=2077;e++){m.push(e);const t=v.find(t=>t.year===e||t.year===e-1||t.year===e+1),o=t&&(e===t.year||e===t.year+1);let n=.12*(Math.random()-.5),i=e<2030?.1:e<2045?.08:.06;if(o&&t){y*=1-t.severity*(.6+.4*Math.random())}else if(2031!==e&&2038!==e||!o)y*=1+i+n;else{y*=1+(.1+.08*Math.random())}Math.random()<.1&&!o&&(y*=.94+.04*Math.random()),y=Math.max(.93*y,1.18*y),p.push(Math.round(100*y)/100);let r=.05*(Math.random()-.5),a=e<2030?.06:e<2045?.04:.03;if(o&&t&&t.severity>.28){f*=1-.25*t.severity*(.7+.3*Math.random())}else if(2031===e||2038===e&&t&&t.severity>.28){f*=1+(.05+.04*Math.random())}else f*=1+a+r;f=Math.max(.97*f,1.13*f),g.push(Math.round(100*f)/100)}const w=m.filter((e,t)=>t%5==0||t===m.length-1),E=Math.max(...p),x=Math.min(...p),b=Math.max(...g),M=Math.min(...g),T=E-x,S=b-M;let R=0;let H=!0;function L(){if(!H&&R>=1)return;n.clearRect(0,0,r,a),n.strokeStyle="rgba(255, 215, 0, 0.15)",n.lineWidth=1;for(let e=0;e<=10;e++){const t=s+h/10*e;n.beginPath(),n.moveTo(d,t),n.lineTo(r-l,t),n.stroke()}for(let e=0;e<w.length;e++){const t=m.indexOf(w[e]),o=d+u/(m.length-1)*t;n.beginPath(),n.moveTo(o,s),n.lineTo(o,a-c),n.stroke()}const i=m.length,y=R*i,f=Math.floor(y),v=y-f;if(f>=1){n.strokeStyle="rgba(255, 215, 0, 0.5)",n.lineWidth=1.5,n.setLineDash([6,4]),n.beginPath();for(let e=0;e<f;e++){const t=d+u/(m.length-1)*e,o=(g[e]-M)/S,i=s+h-o*h;0===e?n.moveTo(t,i):n.lineTo(t,i)}if(f<i&&v>0){const e=d+u/(m.length-1)*f,t=(g[f]-M)/S,o=s+h-t*h;if(0===f)n.moveTo(e,o);else{const t=d+u/(m.length-1)*(f-1),i=(g[f-1]-M)/S,r=s+h-i*h,a=t+(e-t)*v,l=r+(o-r)*v;n.lineTo(a,l)}}n.stroke(),n.setLineDash([])}if(f>=1){n.shadowBlur=6,n.shadowColor="#00ff88",n.strokeStyle="#00ff88",n.lineWidth=2,n.beginPath();for(let e=0;e<f;e++){const t=d+u/(m.length-1)*e,o=(p[e]-x)/T,i=s+h-o*h;0===e?n.moveTo(t,i):n.lineTo(t,i)}if(f<i&&v>0){const e=d+u/(m.length-1)*f,t=(p[f]-x)/T,o=s+h-t*h;if(0===f)n.moveTo(e,o);else{const t=d+u/(m.length-1)*(f-1),i=(p[f-1]-x)/T,r=s+h-i*h,a=t+(e-t)*v,l=r+(o-r)*v;n.lineTo(a,l)}}n.stroke();for(let e=0;e<f;e++)if(e%5==0||e===f-1){const t=d+u/(m.length-1)*e,o=(p[e]-x)/T,i=s+h-o*h;n.shadowBlur=6,n.fillStyle="#00ff88",n.beginPath(),n.arc(t,i,3,0,2*Math.PI),n.fill()}n.shadowBlur=0}n.fillStyle="rgba(255, 215, 0, 0.6)",n.font="11px DM Mono",n.textAlign="center",n.textBaseline="top";for(let e=0;e<w.length;e++){const t=m.indexOf(w[e]),o=d+u/(m.length-1)*t;n.fillText(w[e].toString(),o,a-c+8)}n.textAlign="right",n.textBaseline="middle";for(let e=0;e<=5;e++){const t=s+h/5*(5-e),o=x+T/5*e;n.fillText(Math.round(o).toString(),d-10,t)}R<1?(R+=.008,R>1&&(R=1,H=!1),stockChartAnimationFrame=requestAnimationFrame(L)):(H=!1,t&&!t.classList.contains("visible")&&t.classList.add("visible"),o&&!o.classList.contains("visible")&&o.classList.add("visible"),e&&!e.classList.contains("visible")&&e.classList.add("visible"))}e&&e.classList.add("visible"),R=0,H=!0,setTimeout(()=>{L()},300)}let porscheHistoryScrollRevealActive=!1,porscheHistoryScrollRevealElements=null,porscheHistoryContainerReady=!1;function initPorscheHistoryScrollReveal(){porscheHistoryScrollRevealElements=null,porscheHistoryScrollRevealActive&&(porscheHistoryScrollRevealActive=!1);const e=document.getElementById("porsche-history-content");if(!e)return;const t=document.getElementById("porsche-history-scrollbar"),o=document.getElementById("porsche-history-scrollbar-thumb"),n=document.getElementById("porsche-history-container");function i(){if(!porscheHistoryVisible)return void(t&&(t.style.display="none"));if(!(t&&o&&n&&e))return;if(!porscheHistoryContainerReady)return void(t&&(t.style.display="none"));const i=e.scrollHeight,r=e.clientHeight,a=e.scrollTop;if(i<=r)return void(t.style.display="none");const s=n.getBoundingClientRect();t.style.left=`${s.right+4}px`,t.style.top=`${s.top}px`,t.style.height=`${s.height}px`,t.style.display="block";const l=r/i*t.clientHeight;o.style.height=`${l}px`;const c=i-r,d=c>0?a/c*(t.clientHeight-l):0;o.style.top=`${d}px`}window.addEventListener("resize",i),e.addEventListener("scroll",i);const r=()=>{if(!porscheHistoryVisible)return;const t=e.scrollTop;e.querySelectorAll(".porsche-history-fullwidth-image img, .porsche-history-fullwidth-image video").forEach(o=>{const n=o.parentElement;if(!n)return;const i=n.getBoundingClientRect(),r=e.getBoundingClientRect(),a=i.top-r.top+t,s=a+i.height;if(t>=a-e.clientHeight&&t<=s+e.clientHeight){if((window.getComputedStyle(o).clipPath||"").includes("100%"))return;const e=(t-a)*.3;o.style.transform=`translateY(${e}px)`}})};e.addEventListener("scroll",r),setTimeout(()=>{r()},100);let a=!1,s=0,l=0;o.addEventListener("mousedown",t=>{a=!0,s=t.clientY,l=e.scrollTop,t.preventDefault()}),document.addEventListener("mousemove",n=>{if(!a)return;const i=n.clientY-s,r=t.clientHeight,c=parseFloat(o.style.height)||0,d=e.scrollHeight-e.clientHeight,u=i/(r-c),h=Math.max(0,Math.min(d,l+u*d));e.scrollTop=h}),document.addEventListener("mouseup",()=>{a=!1}),t.addEventListener("click",n=>{if(n.target===o)return;const i=n.clientY-t.getBoundingClientRect().top,r=t.clientHeight,a=(parseFloat(o.style.height),i/r*(e.scrollHeight-e.clientHeight));e.scrollTop=a}),setTimeout(()=>{i()},300);let c=!1;porscheHistoryScrollRevealActive=!0;const d=Array.from(e.querySelectorAll("p")),u=Array.from(e.querySelectorAll("h3")),h=Array.from(e.querySelectorAll(".porsche-history-image-placeholder")),m=Array.from(e.querySelectorAll(".porsche-history-image")),p=Array.from(e.querySelectorAll(".porsche-history-fullwidth-image")),g=Array.from(e.querySelectorAll(".porsche-history-image-caption")),y=e.querySelector(".porsche-history-stock-chart"),f=[...d,...u,...h,...m,...p,...g];y&&f.push(y);let v=new Set;function w(){porscheHistoryVisible&&f.forEach((t,o)=>{if(v.has(t))return;const n=t.getBoundingClientRect(),i=e.getBoundingClientRect();if(n.top-i.top<e.clientHeight-150){if(v.add(t),t.classList.contains("porsche-history-stock-chart")&&!c){c=!0;const e=t.querySelector(".porsche-history-stock-chart-title"),o=t.querySelector(".porsche-history-stock-chart-legend");e&&e.classList.add("visible"),o&&o.classList.add("visible"),initStockChart()}if(t.classList.contains("porsche-history-image")){let e=t.querySelector(".porsche-history-image-placeholder-block");e||(e=document.createElement("div"),e.className="porsche-history-image-placeholder-block",t.insertBefore(e,t.firstChild));const o=t.querySelector("img")||t.querySelector("video");t.style.opacity="1",t.style.transform="translateY(0)",o&&(o.style.clipPath="inset(0 100% 0 0)"),e.style.clipPath="inset(0 100% 0 0)";const n=window.gsap||window.GSAP;n?(n.to(e,{clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}),setTimeout(()=>{t.classList.add("visible"),o&&n.to(o,{clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut",onComplete:()=>{n.to(e,{opacity:0,duration:.3,ease:"power2.out"})}})},200)):setTimeout(()=>{e.style.clipPath="inset(0 0% 0 0)",setTimeout(()=>{t.classList.add("visible"),o&&(o.style.clipPath="inset(0 0% 0 0)",setTimeout(()=>{e.style.opacity="0"},800))},200)},50);const i=t.parentElement,r=i?i.querySelector(".porsche-history-image-caption"):null;if(r){v.add(r);const e=window.gsap||window.GSAP;e?(e.set(r,{opacity:0,y:10,clipPath:"inset(0 100% 0 0)"}),r.classList.add("visible"),setTimeout(()=>{e.to(r,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"})},800)):setTimeout(()=>{r.style.opacity="1",r.style.transform="translateY(0)",r.style.clipPath="inset(0 0% 0 0)"},800)}}else if(t.classList.contains("porsche-history-fullwidth-image")){const e=t.querySelector("img")||t.querySelector("video");if(!e)return;let o=t.querySelector(".porsche-history-fullwidth-image-placeholder-block");o||(o=document.createElement("div"),o.className="porsche-history-fullwidth-image-placeholder-block",t.insertBefore(o,t.firstChild));const n=t.querySelector(".porsche-history-fullwidth-image-caption");e.style.opacity="1",e.style.clipPath="inset(0 100% 0 0)",o.style.clipPath="inset(0 100% 0 0)",n&&(v.add(n),n.style.opacity="0",n.style.transform="translateY(10px)",n.style.clipPath="inset(0 100% 0 0)");const i=window.gsap||window.GSAP,r=()=>{i?(i.to(o,{clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}),setTimeout(()=>{i.to(e,{clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut",onComplete:()=>{i.to(o,{opacity:0,duration:.3,ease:"power2.out"}),"IMG"===e.tagName?e.complete&&0!==e.naturalHeight?a(n,i):(e.addEventListener("load",()=>{a(n,i)},{once:!0}),e.addEventListener("error",()=>{a(n,i)},{once:!0})):"VIDEO"===e.tagName&&(e.readyState>=2?a(n,i):(e.addEventListener("loadeddata",()=>{a(n,i)},{once:!0}),e.addEventListener("error",()=>{a(n,i)},{once:!0})))}})},200)):setTimeout(()=>{o.style.clipPath="inset(0 0% 0 0)",setTimeout(()=>{e.style.clipPath="inset(0 0% 0 0)","IMG"===e.tagName&&e.complete&&0!==e.naturalHeight||"VIDEO"===e.tagName&&e.readyState>=2?a(n,null):"IMG"===e.tagName?e.addEventListener("load",()=>{a(n,null)},{once:!0}):"VIDEO"===e.tagName&&e.addEventListener("loadeddata",()=>{a(n,null)},{once:!0})},200)},50)},a=(e,t)=>{e&&(e.classList.add("visible"),t?t.to(e,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}):setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)",e.style.clipPath="inset(0 0% 0 0)"},50))};r()}else if("P"===t.tagName||"H3"===t.tagName){t.style.opacity="0",t.style.transform="translateY(20px)",t.style.clipPath="inset(0 100% 0 0)",t.classList.add("visible");const e=window.gsap||window.GSAP;e?e.to(t,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:1,ease:"power2.out"}):setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)",t.style.clipPath="inset(0 0% 0 0)"},50)}else{if(t.classList.contains("porsche-history-image-caption")){const e=t.parentElement,o=e?e.querySelector(".porsche-history-image"):null;if(o&&v.has(o)){v.add(t),t.style.opacity="0",t.style.transform="translateY(10px)",t.style.clipPath="inset(0 100% 0 0)",t.classList.add("visible");const e=window.gsap||window.GSAP;e?e.to(t,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}):setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)",t.style.clipPath="inset(0 0% 0 0)"},50)}else if(!o){v.add(t),t.style.opacity="0",t.style.transform="translateY(10px)",t.style.clipPath="inset(0 100% 0 0)",t.classList.add("visible");const e=window.gsap||window.GSAP;e?e.to(t,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"}):setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)",t.style.clipPath="inset(0 0% 0 0)"},50)}return}{t.style.opacity="0",t.style.transform="translateY(10px)",t.classList.add("visible");const e=window.gsap||window.GSAP;e?e.to(t,{opacity:1,y:0,duration:.6,ease:"power2.out"}):setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},50)}}}})}porscheHistoryScrollRevealElements=v,f.length>0&&setTimeout(()=>{f.slice(0,Math.min(2,f.length)).forEach((e,t)=>{if(v.add(e),e.classList.contains("porsche-history-image")){e.style.opacity="0",e.style.transform="translateY(10px)",e.style.clipPath="inset(0 100% 0 0)",e.classList.add("visible");const o=window.gsap||window.GSAP;o?o.to(e,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,delay:.1*t,ease:"expo.inOut"}):setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)",e.style.clipPath="inset(0 0% 0 0)"},100*t);const n=e.parentElement,i=n?n.querySelector(".porsche-history-image-caption"):null;if(i){v.add(i);const e=window.gsap||window.GSAP;if(e){e.set(i,{opacity:0,y:10,clipPath:"inset(0 100% 0 0)"}),i.classList.add("visible");setTimeout(()=>{e.to(i,{opacity:1,y:0,clipPath:"inset(0 0% 0 0)",duration:.8,ease:"expo.inOut"})},800+1e3*(.1*t))}else setTimeout(()=>{i.style.opacity="1",i.style.transform="translateY(0)",i.style.clipPath="inset(0 0% 0 0)"},800)}}else{if(e.classList.contains("porsche-history-image-caption"))return;{e.style.opacity="0",e.style.transform="translateY(10px)",e.classList.add("visible");const o=window.gsap||window.GSAP;o?o.to(e,{opacity:1,y:0,duration:.6,delay:.1*t,ease:"power2.out"}):setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},100*t)}}})},200);const E=e.querySelector(".porsche-history-done-button"),x=e.querySelector(".porsche-history-buy-button");function b(){if(!E)return;const t=e.scrollTop;if(e.scrollHeight-t-e.clientHeight<200){if(E&&!E.classList.contains("visible")){E.classList.add("visible");const e=window.gsap||window.GSAP;e&&e.to(E,{opacity:1,y:0,duration:.6,ease:"power2.out"})}if(x&&!x.classList.contains("visible")){x.classList.add("visible");const e=window.gsap||window.GSAP;e&&e.to(x,{opacity:1,y:0,duration:.6,delay:.1,ease:"power2.out"})}}}E&&(E.addEventListener("click",()=>{hidePorscheHistory()}),E.addEventListener("mouseenter",()=>{createUISound("hover")})),x&&(x.addEventListener("click",()=>{hidePorscheHistory(),setTimeout(()=>{showOutOfFundsPopup()},450)}),x.addEventListener("mouseenter",()=>{createUISound("hover")}));e.addEventListener("scroll",()=>{w(),E&&b()}),E&&b(),setTimeout(()=>{w()},100)}function hidePorscheHistory(){const e=window.gsap||window.GSAP,t=document.getElementById("porsche-history-overlay"),o=document.getElementById("porsche-history-container"),n=document.getElementById("porsche-history-backdrop");if(!t||!o)return;porscheHistoryScrollRevealActive=!1,porscheHistoryScrollRevealElements=null,porscheHistoryFollowAnimation&&(porscheHistoryFollowAnimation.kill(),porscheHistoryFollowAnimation=null),porscheHistoryMouseFollow.x=0,porscheHistoryMouseFollow.y=0,porscheHistoryMouseFollow.targetX=0,porscheHistoryMouseFollow.targetY=0;const i=document.getElementById("porsche-history-content");i&&(i.scrollTop=0);const r=document.getElementById("porsche-history-title");if(r&&(r.style.opacity="0",r.style.transform="translateY(10px)",r.style.clipPath="inset(0 100% 0 0)"),i){i.querySelectorAll("p, h3, .porsche-history-image-placeholder, .porsche-history-image-caption, .porsche-history-done-button, .porsche-history-buy-button").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(10px)"});i.querySelectorAll(".porsche-history-image").forEach(e=>{e.classList.remove("visible"),e.style.opacity="0",e.style.transform="translateY(10px)"})}e.to([t,o],{opacity:0,duration:.2,ease:"power2.in",onComplete:()=>{t.classList.remove("visible"),window._porscheHistoryWheelHandler&&(window.removeEventListener("wheel",window._porscheHistoryWheelHandler,{capture:!0}),delete window._porscheHistoryWheelHandler),porscheHistoryVisible=!1,document.body.classList.remove("menu-open"),e.set([t,o],{opacity:1});const n=document.getElementById("part-container"),i=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[n,...i].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),n&&infoPanelEnabled&&e.to(n,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0}),i.forEach(t=>{t&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:1,duration:.3,ease:"power2.out"})}}),e.to(n,{opacity:0,duration:.3}),console.log("Porsche history popup hidden")}function showOutOfFundsPopup(){const e=window.gsap||window.GSAP,t=document.getElementById("out-of-funds-overlay"),o=document.getElementById("out-of-funds-container"),n=document.getElementById("out-of-funds-backdrop"),i=document.getElementById("out-of-funds-button");if(!t||!o)return void console.warn("Out of funds elements not found",{overlay:t,container:o});console.log("Showing Out of Funds popup");const r=document.getElementById("part-container"),a=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[r,...a].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),r&&e.to(r,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0}),a.forEach(t=>{t&&e.to(t,{opacity:0,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:0,duration:.3,ease:"power2.out"}),i&&(i.style.opacity="0",i.style.transform="translateY(20px)"),t.classList.add("visible"),e.set(t,{opacity:1}),e.fromTo(n,{opacity:0},{opacity:1,duration:.3,ease:"power2.out"}),e.set(o,{clipPath:"inset(0% 0% 100% 0%)",y:-50}),e.to(o,{clipPath:"inset(0% 0% 0% 0%)",y:0,duration:.25,ease:"circ.out",onComplete:()=>{i&&(e.set(i,{opacity:0,y:-20}),e.to(i,{opacity:1,y:0,duration:.3,delay:0,ease:"power1.out"}))}}),outOfFundsVisible=!0,document.body.classList.add("menu-open"),i&&(i.onclick=()=>hideOutOfFundsPopup()),n&&(n.onclick=e=>{e.target===n&&hideOutOfFundsPopup()})}function hideOutOfFundsPopup(){const e=window.gsap||window.GSAP,t=document.getElementById("out-of-funds-overlay"),o=document.getElementById("out-of-funds-container"),n=document.getElementById("out-of-funds-backdrop");t&&o&&(e.to(o,{clipPath:"inset(0% 0% 100% 0%)",y:0,duration:.4,ease:"power2.in",onComplete:()=>{t.classList.remove("visible"),outOfFundsVisible=!1,document.body.classList.remove("menu-open");const o=document.getElementById("part-container"),n=[document.getElementById("music-player"),document.getElementById("fullscreen-button"),document.getElementById("rotate-button"),document.getElementById("info-button"),document.getElementById("book-button")];[o,...n].filter(e=>null!==e).forEach(e=>{e.style.transition="none"}),o&&infoPanelEnabled&&e.to(o,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0}),n.forEach(t=>{t&&e.to(t,{opacity:1,duration:.3,ease:"power2.out",overwrite:!0})}),uiCogMesh&&uiCogMesh.material&&e.to(uiCogMesh.material,{opacity:1,duration:.3,ease:"power2.out"})}}),e.to(n,{opacity:0,duration:.3}),console.log("Out of funds popup hidden"))}window.addEventListener("keydown",e=>{"Escape"===e.key&&(outOfFundsVisible?hideOutOfFundsPopup():menuVisible?hidePartMenu():porscheHistoryVisible&&hidePorscheHistory())});const loader=new FBXLoader;let porscheModel=null;function animate(){requestAnimationFrame(animate),grainTime+=.01,grainPass.uniforms.time.value=grainTime;const e=scene.getObjectByName("ambientDust");if(e&&e.geometry){const t=e.geometry.attributes.position.array,o=e.userData.velocities,n=e.userData.originalPositions;for(let e=0;e<t.length;e+=3){t[e]+=o[e],t[e+1]+=o[e+1],t[e+2]+=o[e+2];const i=6;Math.sqrt(t[e]*t[e]+t[e+2]*t[e+2])>i&&(t[e]=n[e],t[e+1]=n[e+1],t[e+2]=n[e+2])}e.geometry.attributes.position.needsUpdate=!0;let i=16766720;if(hoveredMesh){const e=hoveredMesh.uuid.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),t=Math.abs(e)%3;i=0===t?4521796:1===t?16729156:16766720}const r=i-e.userData.currentColor;Math.abs(r)>.1&&(e.userData.currentColor+=.05*r,e.material.color.setHex(e.userData.currentColor))}if(boundingBoxAnimation.isAnimating&&boundingBoxHelper){const e=performance.now()-boundingBoxAnimation.startTime,t=Math.min(e/boundingBoxAnimation.duration,1),o=easeOut(t);boundingBoxAnimation.currentScale.lerpVectors(boundingBoxAnimation.startScale,boundingBoxAnimation.targetScale,o),boundingBoxHelper.scale.copy(boundingBoxAnimation.currentScale),boundingBoxAnimation.cornerIndicators.forEach(e=>{e.scale.copy(boundingBoxAnimation.currentScale)}),t>=1&&(boundingBoxAnimation.isAnimating=!1,boundingBoxHelper.scale.set(1,1,1),boundingBoxAnimation.cornerIndicators.forEach(e=>{e.scale.set(1,1,1)}))}if(lockRing){if(lockRingAnim.active){const e=performance.now(),t=Math.min(1,(e-lockRingAnim.startTime)/lockRingAnim.duration),o=1-Math.pow(1-t,3),n=lockRingAnim.fromScale+(lockRingAnim.toScale-lockRingAnim.fromScale)*o,i=lockRingAnim.fromThick+(lockRingAnim.toThick-lockRingAnim.fromThick)*o,r=lockRingAnim.fromOpacity+(lockRingAnim.toOpacity-lockRingAnim.fromOpacity)*o;if(lockRing.scale.set(n,n,n),lockRing.material.opacity=r,Math.abs(i-lockRingThickness)>1e-4){lockRingThickness=i;const e=lockRing.userData.baseRadius||1,t=lockRing.userData.segments||32,o=buildLockRingGeometry(e,lockRingThickness,t);lockRing.geometry.dispose(),lockRing.geometry=o}t>=1&&(lockRingAnim.active=!1)}if(porscheModel){const e=(new THREE.Box3).setFromObject(porscheModel),t=(e.getSize(new THREE.Vector3),e.getCenter(new THREE.Vector3));lockRing.position.set(t.x,t.y,t.z),lockRing.rotation.y=porscheModel.rotation.y}}if(uiCogMesh)try{uiCogMesh.rotation.y+=.01,layoutUICog()}catch(e){}document.getElementById("part-info");if(cornerIndicators.length>0){const e=60,t=Math.sin(grainTime*e)>0?1:0;cornerIndicators.forEach(e=>{e.material&&(e.material.opacity=t,e.material.transparent=!0)})}if(cornerLabels.length>0){const e=window.innerWidth,t=window.innerHeight,o=new THREE.Vector3,n=new THREE.Vector3;cornerLabels.forEach(({anchor:i,el:r})=>{if(!i||!r)return;i.getWorldPosition(o),n.copy(o).project(camera);const a=(.5*n.x+.5)*e;let s=(.5*-n.y+.5)*t;s-=20,r.style.left=`${a}px`,r.style.top=`${s}px`,r.textContent=`X ${o.x.toFixed(2)}  Y ${o.y.toFixed(2)}  Z ${o.z.toFixed(2)}`})}const t=document.getElementById("tooltip-status"),o=document.getElementById("tooltip-icon");if(t&&t.classList.contains("blinking")){const e=60,o=Math.sin(grainTime*e)>0?1:0;t.style.opacity=o}if(o&&o.classList.contains("blinking")){const e=60,t=Math.sin(grainTime*e)>0?1:0;o.style.opacity=t}if(uiHoverBlinkTargets.length>0){const e=60,t=Math.sin(grainTime*e)>0?1:0;for(let e=0;e<uiHoverBlinkTargets.length;e++){const o=uiHoverBlinkTargets[e];o.classList.contains("ui-hover-blink")&&(o.style.opacity=t)}}if(orbitParents.length>0&&orbitParents.forEach(({parent:e,spinSpeed:t})=>{e.rotation.y+=.01*t}),scatteredCrosses.length>0&&scatteredCrosses.forEach(e=>{e.material&&(e.material.opacity=.55,e.material.transparent=!0)}),targetText.length>0){textDecodeIndex<targetText.length&&(textDecodeIndex+=textDecodeSpeed);const e=Math.min(Math.floor(textDecodeIndex),targetText.length);currentText=targetText.substring(0,e);const t=document.getElementById("part-name");t&&(t.textContent=currentText)}if(tooltipTypewriterActive&&tooltipTypewriterIndex<tooltipTargetText.length){tooltipTypewriterIndex+=tooltipTypewriterSpeed,tooltipTypewriterIndex>=tooltipTargetText.length&&(tooltipTypewriterIndex=tooltipTargetText.length),tooltipCurrentText=tooltipTargetText.substring(0,Math.floor(tooltipTypewriterIndex));const e=document.getElementById("tooltip-part-name");e&&(e.textContent=tooltipCurrentText)}controls.update(),porscheModel&&autoRotateEnabled&&(porscheModel.rotation.y+=.005,porscheModel.traverse(e=>{e.isMesh&&e.material&&e.material.userData&&(e.material.userData.mouseX=mouseX,e.material.userData.mouseY=mouseY)})),composer.render()}function resetHoverStates(){if(hoveredMesh&&hoveredMesh.userData.originalMaterial){hoveredMesh.material&&hoveredMesh.material.dispose();const e=hoveredMesh.userData.originalMaterial.clone();hoveredMesh.material=e,hoveredMesh.userData.originalMaterial=null}hoveredMesh=null,hoverFadeProgress=0,warningMesh&&warningMesh.material&&void 0!==warningOriginalEmissive&&(warningMesh.material.emissive=warningOriginalEmissive.clone(),warningMesh.material.emissiveIntensity=warningOriginalEmissiveIntensity,warningMesh.material.needsUpdate=!0);const e=scene.getObjectByName("ambientDust");e&&e.userData&&(e.userData.currentColor=16766720,e.material.color.setHex(16766720)),console.log("Hover states reset")}loader.load("Media/porsche_911.fbx",e=>{console.log("Porsche model loaded successfully"),e.scale.multiplyScalar(.01),console.log("=== FBX Model Parts ===");const t=[];e.traverse(e=>{if(e.isMesh){const o=(new THREE.Box3).setFromObject(e),n=o.getCenter(new THREE.Vector3),i=o.getSize(new THREE.Vector3),r={name:e.name,type:e.geometry.type,position:n,size:i,mesh:e};t.push(r);const a=e.material?Array.isArray(e.material)?`[${e.material.length} mats]`:`Material: ${e.material.name||"unnamed"} | Color: ${e.material.color?.getHexString()||"N/A"}`:"No material";console.log(`Mesh: "${e.name}" | Type: ${e.geometry.type} | ${a}`)}});const o=[];e.traverse(e=>{if(e.isMesh){const t=e.name.toLowerCase();if(t.includes("podium")||t.includes("base")||t.includes("platform")||t.includes("stand")||t.includes("pedestal"))o.push(e),console.log("Removing by name:",e.name);else{const t=(new THREE.Box3).setFromObject(e),n=t.getSize(new THREE.Vector3),i=t.getCenter(new THREE.Vector3);("CylinderGeometry"===e.geometry.type||"CircleGeometry"===e.geometry.type||"BoxGeometry"===e.geometry.type)&&Math.max(n.x,n.z)>Math.max(2*n.y)&&n.y<.3*Math.max(n.x,n.z)&&i.y<0&&(o.push(e),console.log("Removing likely base by geometry:",e.name))}}}),o.forEach(e=>{e.parent&&e.parent.remove(e),e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())});const n={carrosserie:"Body Panel",carosserie:"Body Panel",carroserie:"Body Panel",caroserie:"Body Panel",chassis:"Chassis Frame","châssis":"Chassis Frame",cadre:"Frame Structure",coque:"Body Shell",exterieur:"Exterior Panel","extérieur":"Exterior Panel",interieur:"Interior Panel","intérieur":"Interior Panel",porte:"Door Panel",portes:"Door Panel",capot:"Hood Panel",coffre:"Trunk Lid",pare:"Bumper",pare:"Windshield",grille:"Front Grille",vitre:"Window Glass",vitres:"Window Glass",fenetre:"Window Glass","fenêtre":"Window Glass",fenetres:"Window Glass","fenêtres":"Window Glass",retro:"Side Mirror","rétro":"Side Mirror",retroviseur:"Side Mirror","rétroviseur":"Side Mirror",siege:"Seat Assembly","siège":"Seat Assembly",sieges:"Seat Assembly","sièges":"Seat Assembly",volant:"Steering Wheel",tableau:"Dashboard",tableau:"Dashboard",console:"Center Console",pedale:"Pedal Assembly","pédale":"Pedal Assembly",pedales:"Pedal Assembly","pédales":"Pedal Assembly",frein:"Brake System",freins:"Brake System",roue:"Wheel Assembly",roues:"Wheel Assembly",pneu:"Tire",pneus:"Tire",jante:"Wheel Rim",jantes:"Wheel Rim",suspension:"Suspension System",suspensions:"Suspension System",amortisseur:"Shock Absorber",amortisseurs:"Shock Absorber",ressort:"Coil Spring",ressorts:"Coil Spring",moteur:"Engine Block",cylindre:"Cylinder Head",cylindres:"Cylinder Head",piston:"Piston Assembly",pistons:"Piston Assembly",vilebrequin:"Crankshaft",arbre:"Camshaft",soupape:"Valve System",soupapes:"Valve System",admission:"Intake Manifold",echappement:"Exhaust System","échappement":"Exhaust System",turbo:"Turbocharger",compresseur:"Supercharger",batterie:"Battery",alternateur:"Alternator",demarreur:"Starter Motor","démarreur":"Starter Motor",allumage:"Ignition System",bougie:"Spark Plug",bougies:"Spark Plug",bobine:"Ignition Coil",bobines:"Ignition Coil",fil:"Wiring Harness",fils:"Wiring Harness",fusible:"Fuse Box",fusibles:"Fuse Box",relais:"Relay Module",transmission:"Transmission",boite:"Gearbox","boîte":"Gearbox",embrayage:"Clutch Assembly",volant:"Flywheel",differentiel:"Differential","différentiel":"Differential",essieu:"Drive Axle",essieux:"Drive Axle",cardan:"Driveshaft",radiateur:"Radiator",refroidissement:"Coolant System",thermostat:"Thermostat",pompe:"Water Pump",ventilateur:"Cooling Fan",ventilateurs:"Cooling Fan",tuyau:"Coolant Hose",tuyaux:"Coolant Hose",carburant:"Fuel System",reservoir:"Fuel Tank","réservoir":"Fuel Tank",injecteur:"Fuel Injector",injecteurs:"Fuel Injector",filtre:"Fuel Filter",filtres:"Fuel Filter",ligne:"Fuel Line",lignes:"Fuel Line",air:"Air System",masse:"Mass Air Flow Sensor",papillon:"Throttle Body",phare:"Headlight",phares:"Headlight",feu:"Taillight",feux:"Taillight",clignotant:"Turn Signal",clignotants:"Turn Signal",antibrouillard:"Fog Light",antibrouillards:"Fog Light",led:"LED Light",aileron:"Spoiler",ailerons:"Spoiler",antenne:"Antenna",antennes:"Antenna",essuie:"Wiper Blade",essuie:"Wiper Blade",silencieux:"Muffler",catalyseur:"Catalytic Converter",capteur:"Sensor Unit",capteurs:"Sensor Unit",calculateur:"Engine Control Unit",abs:"ABS System",airbag:"Airbag System",airbags:"Airbag System",disque:"Brake Disc",disques:"Brake Disc",porterie:"Door Assembly",porteries:"Door Assembly",portiere:"Door Panel",portieres:"Door Panel",planche:"Dashboard",planches:"Dashboard",baguette:"Trim Strip",baguettes:"Trim Strip",enjo:"Wheel Hub",enjos:"Wheel Hub",body:"Body Panel",chassis:"Chassis Frame",frame:"Frame Structure",shell:"Body Shell",exterior:"Exterior Panel",engine:"Engine Block",motor:"Engine Motor",cylinder:"Cylinder Head",piston:"Piston Assembly",crankshaft:"Crankshaft",camshaft:"Camshaft",valve:"Valve System",intake:"Intake Manifold",exhaust:"Exhaust System",turbo:"Turbocharger",supercharger:"Supercharger",wheel:"Wheel Assembly",tire:"Tire",rim:"Wheel Rim",suspension:"Suspension System",shock:"Shock Absorber",spring:"Coil Spring",strut:"Strut Assembly",control:"Control Arm",brake:"Brake System",rotor:"Brake Rotor",caliper:"Brake Caliper",pad:"Brake Pad",seat:"Seat Assembly",dashboard:"Dashboard",steering:"Steering Wheel",pedal:"Pedal Assembly",console:"Center Console",door:"Door Panel",porte:"Door Panel",portiere:"Door Panel","portière":"Door Panel",porteri:"Door Panel",handle:"Door Handle",mirror:"Side Mirror",battery:"Battery",alternator:"Alternator",starter:"Starter Motor",ignition:"Ignition System",spark:"Spark Plug",coil:"Ignition Coil",wire:"Wiring Harness",fuse:"Fuse Box",relay:"Relay Module",transmission:"Transmission",gearbox:"Gearbox",levier:"Gearbox","levier de vitesse":"Gearbox","levier-vitesse":"Gearbox",clutch:"Clutch Assembly",flywheel:"Flywheel",differential:"Differential",axle:"Drive Axle",driveshaft:"Driveshaft",cv:"CV Joint",radiator:"Radiator",coolant:"Coolant System",thermostat:"Thermostat",water:"Water Pump",fan:"Cooling Fan",hose:"Coolant Hose",fuel:"Fuel System",tank:"Fuel Tank",pump:"Fuel Pump",injector:"Fuel Injector",filter:"Fuel Filter",line:"Fuel Line",air:"Air System",filter:"Air Filter",mass:"Mass Air Flow Sensor",throttle:"Throttle Body",glass:"Glass Panel",window:"Window Glass",windshield:"Windshield",windscreen:"Windscreen",rear:"Rear Window",side:"Side Window",light:"Light Assembly",headlight:"Headlight",taillight:"Taillight",brake:"Brake Light",turn:"Turn Signal",fog:"Fog Light",led:"LED Light",bumper:"Bumper",grille:"Front Grille",hood:"Hood Panel",trunk:"Trunk Lid",spoiler:"Spoiler",wing:"Rear Wing",antenna:"Antenna",wiper:"Wiper Blade",muffler:"Muffler",catalyst:"Catalytic Converter",sensor:"Sensor Unit",ecu:"Engine Control Unit",abs:"ABS System",airbag:"Airbag System"},i=(new THREE.Box3).setFromObject(e),r=i.getCenter(new THREE.Vector3),a=i.getSize(new THREE.Vector3),s=Math.max(a.x,a.y,a.z);e.traverse(e=>{if(e.isMesh&&e.name){const t=e.name.toLowerCase();let o=!1;const i=t.replace(/[0-9_\-\.]/g," ").replace(/\b(mesh|part|object|group|node|porsche|911)\b/g,"").trim(),a=(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[0-9_\-\.]/g," "),l=(i||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"");for(const[r,s]of Object.entries(n)){const n=(r||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"");if(t.includes(r)||i.includes(r)||a.includes(n)||l.includes(n)){e.name=s,console.log(`Renamed: "${t}" -> "${s}"`),o=!0;break}}if(o&&"Gearbox"===e.name){const t=(new THREE.Box3).setFromObject(e),o=t.getCenter(new THREE.Vector3).sub(r),n=t.getSize(new THREE.Vector3),i=Math.abs(o.x)>.1*s,a=n.y>.6*n.x&&n.z<.8*s;i&&a&&(e.name="Door Panel")}if(!o){const o=i.split(/\s+/).filter(e=>e.length>2&&!["part","mesh","object","group","node","porsche","911","car"].includes(e));if(o.length>0){const n=o.map(e=>e.charAt(0).toUpperCase()+e.slice(1));e.name=n.join(" "),console.log(`Generic rename: "${t}" -> "${e.name}"`)}else{const o=(new THREE.Box3).setFromObject(e),n=o.getCenter(new THREE.Vector3);o.getSize(new THREE.Vector3);n.y>.5?e.name="Upper Body Panel":n.y<-.5?e.name="Lower Body Panel":n.x>.3?e.name="Right Side Panel":n.x<-.3?e.name="Left Side Panel":e.name="Center Body Panel",console.log(`Position-based rename: "${t}" -> "${e.name}"`)}}}});const l=(new THREE.Box3).setFromObject(e),c=l.getCenter(new THREE.Vector3);e.position.sub(c),e.updateMatrixWorld(!0),e.traverse(e=>{(e.isMesh||e.isGroup)&&(e.userData.originalLocalMatrix=e.matrix.clone())}),e.traverse(e=>{if(e.userData&&e.userData.originalLocalMatrix&&(e.isMesh||e.isGroup)){const t=e.userData.originalLocalMatrix;e.matrix.copy(t),e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0)}});const d=[];if(e.traverse(e=>{if(e.isMesh){const t=e.name.toLowerCase(),o=(e.material?.name||"").toLowerCase();if(t.includes("glass")||t.includes("window")||t.includes("windshield")||t.includes("windscreen")||"glass"===o||"window"===o||"windshield"===o){console.log("Converting to glass:",e.name,"Material:",e.material?.name),__sharedGlassMaterial?(__sharedGlassMaterial.envMap=scene.environment,__sharedGlassMaterial.opacity=.52,__sharedGlassMaterial.needsUpdate=!0):__sharedGlassMaterial=new THREE.MeshPhysicalMaterial({color:3355443,opacity:.52,transparent:!0,side:THREE.DoubleSide,roughness:0,metalness:1,envMapIntensity:1,envMap:scene.environment,clearcoat:1,clearcoatRoughness:0,sheen:2.5,sheenRoughness:.3,sheenColor:new THREE.Color(16766720),iridescence:1,iridescenceIOR:1.3,iridescenceThicknessRange:[100,500],depthWrite:!1}),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose(),e.material=__sharedGlassMaterial,e.material.needsUpdate=!0,e.renderOrder=1e3,e.castShadow=!1,e.receiveShadow=!1,e.userData.isGlass=!0;const t=(e.name||"").toLowerCase();(t.includes("windshield")||t.includes("windscreen"))&&(e.userData.displayName="Window Glass"),d.push(e)}}}),d.length>1){const e=new Map,t=new THREE.Box3,o=new THREE.Vector3;d.forEach(n=>{t.setFromObject(n);const i=t.getSize(new THREE.Vector3);t.getCenter(o);const r=[Math.round(50*o.x)/50,Math.round(50*o.y)/50,Math.round(50*o.z)/50,Math.round(50*i.x)/50,Math.round(50*i.y)/50,Math.round(50*i.z)/50].join("|");e.has(r)||e.set(r,[]),e.get(r).push(n)}),e.forEach(e=>{if(e.length>1)for(let t=1;t<e.length;t++)e[t].visible=!1,e[t].userData.hiddenAsDuplicateGlass=!0})}e.traverse(e=>{if(e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.material&&!e.userData.isGlass)){const t=new THREE.Color(3355443);t.multiplyScalar(1.2);const o=new THREE.MeshPhysicalMaterial({color:t,opacity:.9,transparent:!0,roughness:0,metalness:1,envMapIntensity:1.2,envMap:scene.environment,clearcoat:1,clearcoatRoughness:0,sheen:2.5,sheenRoughness:.3,sheenColor:new THREE.Color(16766720),iridescence:1,iridescenceIOR:1.3,iridescenceThicknessRange:[100,500]});Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose(),e.material=o,e.material.side=THREE.DoubleSide,e.material.needsUpdate=!0}}),function(e){const t=[],o=new THREE.Vector3,n=(new THREE.Box3).setFromObject(e),i=n.getSize(new THREE.Vector3),r=.5*Math.max(i.x,i.z);if(e.traverse(e=>{if(!e.isMesh)return;const i=(e.name||"").toLowerCase(),a=i.includes("floor")||i.includes("podium")||i.includes("base")||i.includes("platform")||i.includes("stand")||i.includes("pedestal")||i.includes("disc")||i.includes("circle"),s=(new THREE.Box3).setFromObject(e),l=s.getSize(o),c=(a?3:0)+(Math.abs(l.x-l.z)<=.12*Math.max(l.x,l.z)?2:0)+(l.y<=.08*Math.max(l.x,l.z)?1:0)+(Math.max(l.x,l.z)>=r?1:0)+(s.getCenter(o).y<=n.getCenter(new THREE.Vector3).y+.5*l.y?1:0);c>0&&t.push({child:e,score:c,area:l.x*l.z})}),0===t.length)return;t.sort((e,t)=>t.score-e.score||t.area-e.area);const a=t[0].child;scene.attach(a),a.name="Podium",a.material=new THREE.MeshStandardMaterial({color:1710618,roughness:.5,metalness:.65,envMapIntensity:.45}),a.material.side=THREE.DoubleSide,a.material.needsUpdate=!0,a.receiveShadow=!0,a.castShadow=!1,a.userData.isPodium=!0,a.updateMatrixWorld(!0),console.log("[Podium]",{name:a.name,uuid:a.uuid}),function(e){try{const t=(new THREE.Box3).setFromObject(e),o=t.getSize(new THREE.Vector3),n=.48*Math.max(o.x,o.z),i=t.getCenter(new THREE.Vector3),r=t.max.y+Math.max(.015*o.y,.008)+.002,a=new THREE.CircleGeometry(n,128),s=new Reflector(a,{clipBias:.003,textureWidth:Math.max(256,Math.floor(.35*window.innerWidth)),textureHeight:Math.max(256,Math.floor(.35*window.innerHeight)),color:16777215,multisample:2});s.frustumCulled=!1;const l=new THREE.Vector3(i.x,r,i.z),c=e.worldToLocal(l.clone());s.position.copy(c),s.rotation.set(0,0,0),s.material.transparent=!0,s.material.opacity=.04,s.material.depthWrite=!1,s.material.depthTest=!0,s.material.fog=!1,s.renderOrder=999,s.name="GroundReflection",s.material.uniforms&&s.material.uniforms.color&&s.material.uniforms.color.value.multiplyScalar(.5),function(e){const t=512,o=document.createElement("canvas");o.width=t,o.height=t;const n=o.getContext("2d"),i=n.createRadialGradient(256,256,51.2,256,256,256);i.addColorStop(0,"rgba(255,255,255,0.8)"),i.addColorStop(.4,"rgba(255,255,255,0.2)"),i.addColorStop(1,"rgba(255,255,255,0.005)"),n.fillStyle=i,n.fillRect(0,0,t,t);const r=new THREE.CanvasTexture(o);r.colorSpace=THREE.SRGBColorSpace,e.alphaMap=r,e.needsUpdate=!0}(s.material),e.add(s),s.visible=!0;try{const t=a.clone(),o=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5,side:THREE.DoubleSide,depthWrite:!1}),n=new THREE.Mesh(t,o);n.position.copy(s.position),n.position.y+=.001,n.rotation.copy(s.rotation),n.renderOrder=s.renderOrder+1,n.name="GroundReflectionOverlay",n.visible=!1,e.add(n)}catch(e){console.warn("Overlay disc add failed:",e)}try{const t=.98*n,i=.98*n,r=Math.max(.02*o.y,.01),a=new THREE.CylinderGeometry(t,i,r,128,1,!0),l=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5,side:THREE.DoubleSide,depthWrite:!1}),c=new THREE.Mesh(a,l);c.position.copy(s.position.clone()),c.position.y+=.5*r,c.renderOrder=1e3,c.name="PodiumDarkCylinder",e.add(c),c.visible=!1}catch(e){console.warn("Dark cylinder add failed:",e)}}catch(e){console.warn("Ground reflection failed:",e)}}(a)}(e),function(e){try{function t(e){e.traverse(e=>{e.geometry&&e.geometry.dispose?.(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e?.dispose?.()):e.material.dispose?.())})}const n=[],i=(new THREE.Box3).setFromObject(e),r=i.getCenter(new THREE.Vector3);if(e.traverse(e=>{if(!e.isMesh&&!e.isGroup)return;const t=function(e){const t=e=>e.includes("wheel assembly")||e.includes("wheel")||e.includes("tire")||e.includes("tyre")||e.includes("rim")||e.includes("roue")||e.includes("pneu")||e.includes("assembly");let o=e,n=e;for(;o&&o.parent&&(o.parent.isGroup||o.parent.isObject3D);)t((o.parent.name||"").toLowerCase())&&(n=o.parent),o=o.parent;return n}(e);if(!t||t.__wheelCollected)return;const o=(t.name||"").toLowerCase();if(!(o.includes("wheel assembly")||o.includes("wheel")||o.includes("tire")||o.includes("tyre")||o.includes("rim")||o.includes("roue")||o.includes("pneu")||o.includes("assembly")))return;const i=(new THREE.Box3).setFromObject(t),r=i.getSize(new THREE.Vector3),a=r.length();if(!isFinite(a)||0===a)return;const s=i.getCenter(new THREE.Vector3);Math.abs(r.x-r.z)/Math.max(.001,Math.max(r.x,r.z))<.3&&r.y<.6*Math.max(r.x,r.z)&&(t.__wheelCollected=!0,n.push({node:t,center:s,size:r}))}),n.length<2)return void console.log("[WheelClone] Not enough wheel candidates found:",n.length);const a=n.filter(e=>e.center.x<r.x),s=n.filter(e=>e.center.x>=r.x);if(0===a.length||0===s.length)return void console.log("[WheelClone] Could not split wheels into left/right");function o(e){let t=e[0],o=Math.abs(e[0].center.z-r.z);for(let n=1;n<e.length;n++){const i=Math.abs(e[n].center.z-r.z);i>o&&(t=e[n],o=i)}return t}const l=o(a);let c=o(s);if(!l||!c)return void console.log("[WheelClone] Could not identify rear pair");const d=Math.abs(l.center.z-c.center.z),u=Math.abs(l.size.length()-c.size.length())/Math.max(.001,Math.max(l.size.length(),c.size.length()));console.log("[WheelClone] Candidates:",{leftRear:l.node.name,rightRear:c.node.name,zDelta:d,sizeDelta:u});let h=c.node,m=h.parent||e;h.updateWorldMatrix(!0,!0);const p=h.matrixWorld.clone(),g=new THREE.Vector3,y=new THREE.Quaternion,f=new THREE.Vector3;p.decompose(g,y,f);if(d>.2*i.getSize(new THREE.Vector3).z||u>.6){const x=new THREE.Vector3;l.node.getWorldPosition(x),g.set(r.x+Math.abs(x.x-r.x),x.y,x.z),y.copy(l.node.getWorldQuaternion(new THREE.Quaternion)),f.copy(l.node.getWorldScale(new THREE.Vector3)),h=null,m=e,console.log("[WheelClone] Using mirrored placement fallback at",g.toArray())}const v=l.node,w=v.clone(!0);w.updateMatrixWorld(!0);const E=w.visible;if(scene.attach(w),w.position.copy(g),w.quaternion.copy(y),w.scale.copy(f),w.updateMatrixWorld(!0),m.attach(w),h&&h.name&&(w.name=h.name),w.visible=E,h){h.userData.replacedByClone=!0;const b=h.parent;t(h),b?.remove(h)}else{const M=1.5*Math.max(l.size.x,l.size.z);n.forEach(e=>{if(e.center.distanceTo(g)<M&&e.node!==v){e.node.userData.replacedByClone=!0;const o=e.node.parent;t(e.node),o?.remove(e.node)}})}console.log("[WheelClone] Replaced right-rear wheel with clone of left-rear:",{source:v.name,target:h?h.name:"(mirrored placement)"})}catch(T){console.warn("[WheelClone] Replacement failed:",T)}}(e),function(){if(lockRing)return;const t=scene.getObjectByName("Podium"),o=(new THREE.Box3).setFromObject(e),n=o.getCenter(new THREE.Vector3);let i=1,r=n.y;if(t&&t.isMesh){const e=(new THREE.Box3).setFromObject(t).getSize(new THREE.Vector3);i=.5*Math.max(e.x,e.z)}else{const e=o.getSize(new THREE.Vector3);i=.55*Math.max(e.x,e.z),r=n.y}const a=buildLockRingGeometry(i,lockRingThickness,32),s=new THREE.LineBasicMaterial({color:16766720,transparent:!0,opacity:0});lockRing=new THREE.LineSegments(a,s),lockRing.position.set(n.x,r,n.z),lockRing.rotation.x=0,lockRing.userData.baseRadius=i,lockRing.userData.segments=32,scene.add(lockRing)}(),function(e){const t=(new THREE.Box3).setFromObject(e).getSize(new THREE.Vector3),o=.3*Math.max(t.x,t.y,t.z);e.traverse(e=>{if(!e.isPoints)return;if(e.userData?.isHelper)return;const n=(e.name||"").toLowerCase();if(n.includes("podium")||n.includes("floor")||n.includes("base"))return;const i=(new THREE.Box3).setFromObject(e),r=i.getSize(new THREE.Vector3),a=Math.max(r.x,r.y,r.z),s=i.getCenter(new THREE.Vector3).length()<.05*Math.max(t.x,t.y,t.z),l=a<.03*Math.max(t.x,t.y,t.z),c=e.geometry?.attributes?.position?.count||0;if(s&&l||c>0&&c<30){const t=new THREE.Vector3;if(e.getWorldPosition(t),t.y-=o,e.parent){const o=e.parent.worldToLocal(t.clone());e.position.copy(o)}else e.position.copy(t);e.updateMatrixWorld(!0),e.userData.isSunk=!0}})}(e),scene.add(e),porscheModel=e,assetsReady=!0;const u=l.getSize(new THREE.Vector3),h=Math.max(u.x,u.y,u.z);modelMaxDimension=h;const m=.8*h,p=new THREE.SphereGeometry(m,32,16),g=new THREE.EdgesGeometry(p),y=new THREE.LineSegments(g,new THREE.LineBasicMaterial({color:16766720,transparent:!0,opacity:.6}));y.position.copy(e.position),y.name="referenceSphere",y.userData.isHelper=!0,scene.add(y),camera.position.set(.3825*h,.3078*h,.3825*h),controls.target=new THREE.Vector3(0,0,0),controls.update(),function(e){const t=(new THREE.Box3).setFromObject(e).getCenter(new THREE.Vector3),o=new THREE.Vector3,n=new THREE.Vector3;e.traverse(e=>{if(!e.isMesh||!e.geometry)return;const i=e.geometry;i.attributes.normal||i.computeVertexNormals();const r=i.attributes.position,a=i.attributes.normal;if(!r||!a)return;const s=Math.max(1,Math.floor(r.count/200));let l=0;for(let i=0;i<r.count;i+=s){o.set(r.getX(i),r.getY(i),r.getZ(i)),e.localToWorld(o),n.set(a.getX(i),a.getY(i),a.getZ(i)),n.transformDirection(e.matrixWorld);const s=o.clone().sub(t).normalize();l+=n.dot(s)}})}(e);const f=[];e.traverse(e=>{e.isMesh&&!e.name.toLowerCase().includes("glass")&&(f.push(e),e.userData.originalMaterial=e.material.clone())});let v={allMeshes:f,currentMeshIndex:0,transitionProgress:0,transitionSpeed:.1};const w=new THREE.MeshStandardMaterial({color:16737792,wireframe:!0,emissive:16737792,emissiveIntensity:7.5});e.userData.wireframeCycle=v,e.userData.wireframeMaterial=w;const E=new THREE.BufferGeometry,x=new Float32Array(360),b=new Float32Array(360),M=new THREE.Vector3(5,3,5);for(let e=0;e<120;e++)x[3*e+0]=(2*Math.random()-1)*M.x,x[3*e+1]=(2*Math.random()-1)*M.y+.5,x[3*e+2]=(2*Math.random()-1)*M.z,b[3*e+0]=.02*(Math.random()-.5),b[3*e+1]=.01*(Math.random()-.5),b[3*e+2]=.02*(Math.random()-.5);E.setAttribute("position",new THREE.BufferAttribute(x,3)),E.setAttribute("velocity",new THREE.BufferAttribute(b,3));const T=new THREE.PointsMaterial({color:16766720,size:.03,sizeAttenuation:!0,transparent:!0,opacity:.9}),S=new THREE.Points(E,T);S.name="ambientDust",S.userData={originalPositions:x.slice(),velocities:b,currentColor:16766720},scene.add(S);const R=new THREE.Group;R.name="ghostPointCloud",R.userData.isHelper=!0;const H=new THREE.PointsMaterial({color:16766720,size:.02,sizeAttenuation:!0,transparent:!0,opacity:.28,depthWrite:!1,blending:THREE.AdditiveBlending});e.traverse(e=>{if(e.isMesh&&e.geometry){const t=e.geometry;if(t.attributes&&t.attributes.position){const o=t.attributes.position,n=o.count,i=10,r=Math.max(1,Math.floor(n/i)),a=new Float32Array(3*r);let s=0;for(let e=0;e<n&&s<r;e+=i)a[3*s+0]=o.getX(e),a[3*s+1]=o.getY(e),a[3*s+2]=o.getZ(e),s++;const l=new THREE.BufferGeometry;l.setAttribute("position",new THREE.BufferAttribute(a,3));const c=(new THREE.Box3).setFromObject(e),d=c.getSize(new THREE.Vector3),u=Math.max(d.x,d.y,d.z),h=c.getCenter(new THREE.Vector3).length()<.03*modelMaxDimension;if(u<.01*modelMaxDimension&&h)return;const m=new THREE.Points(l,H.clone());m.position.copy(e.position),m.rotation.copy(e.rotation),m.scale.copy(e.scale),m.matrix.copy(e.matrix),m.matrixAutoUpdate=!1,m.frustumCulled=!0,m.userData.isHelper=!0,R.add(m)}}}),e.add(R),R.visible=!1,createPlanetaryOrbitsAround(e),createScatteredCrossesAround(e,32);let L=null;if(e.traverse(e=>{if(e.isMesh){const t=(e.name||"").toLowerCase();L||(L=e),(t.includes("wheel")||t.includes("tire")||t.includes("rim"))&&(L=e)}}),L&&L.material){warningMesh=L;let e=L.material;Array.isArray(e)&&(e=e[0]),e=e.isMeshStandardMaterial||e.isMeshPhysicalMaterial?e.clone():new THREE.MeshStandardMaterial({color:e.color||new THREE.Color(2236962)}),warningOriginalEmissive=e.emissive?e.emissive.clone():new THREE.Color(0),warningOriginalEmissiveIntensity=e.emissiveIntensity||0,e.emissive=new THREE.Color(16711680),e.emissiveIntensity=0,warningMesh.material=e,warningMesh.material.needsUpdate=!0}},e=>{console.log("Loading progress:",e.loaded/e.total*100+"%")},e=>{console.error("Error loading Porsche model:",e)}),initializeMusicPlayer(),setTimeout(resetHoverStates,1e3),initializeFullscreen(),initializeInfoToggle(),initializeUICog(),initializeRotateToggle(),initializeBookButton(),initializeUIHoverBlink(),function(){const e=document.getElementById("loading-overlay"),t=document.getElementById("loading-text");if(!e)return;const o=performance.now(),n=()=>{const i=performance.now()-o;assetsReady&&i>=1200?(document.querySelectorAll(".ui-fade").forEach(e=>e.classList.add("visible")),t&&(t.style.display="none"),setTimeout(()=>{e.classList.add("hidden"),setTimeout(()=>{try{e.remove()}catch(e){}},1900)},200)):requestAnimationFrame(n)};requestAnimationFrame(n)}(),animate(),window.addEventListener("resize",()=>{fisheyePass&&(fisheyePass.uniforms.aspectRatio.value=window.innerWidth/window.innerHeight),camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),composer.setSize(window.innerWidth,window.innerHeight)});